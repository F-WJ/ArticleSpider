[
{"fav_nums": 1, "title": "如何快速处理线上故障", "url_object_id": "3bcbe2f9d07532bfa45a871a1cd09143", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/daoqidelv/p/6785372.html\">倒骑的驴</a>   </div><h3>概述</h3>\n<p>线上故障通常是指大规模的影响线上服务可用性的问题或者事件，通俗点讲就是：掉‘坑’里了，这个‘坑’就是线上故障！线上故障的处理过程可以形象地表达为：‘踩坑’、‘跳坑’、‘填坑’、‘避坑’。</p>\n<p>线上故障的处理不仅是一项技术活，更是对技术人员/技术团队反应能力、决策能力、判定能力、组织能力的考验。面对突发的生产故障，需要快速定位问题，找到解决方案，快速实施解决方案并不是一件容易的事情。本文主要包括如下内容：线上故障处理的目标、思路、步骤、基础设施。</p>\n<p>本文是依据平时经历的生产故障排查和处理，总结一些肤浅的方法论，以求共同探讨，共同提高，欢迎探讨。</p>\n<h3>线上故障处理的目标</h3>\n<p>任何动物一旦掉进坑里，明智的做法一定是：跳坑–&gt;填坑–&gt;避坑，线上故障处理的过程也一样，优先级从高到低，线上故障处理的目标如下：</p>\n<h4>跳坑</h4>\n<p>‘跳坑’——快速恢复线上服务，或者将对线上服务的影响降到最低。</p>\n<p>线上服务的可用性决定着服务者的客户利益，影响着公司的收益。一旦线上环境不可用，无法服务用户，给公司/团队带来经济利益损失的同时，更为严重的会给公司/团队带来恶劣的名声。所以一般公司都会对线上环境提出稳定性和可靠性的要求，这也是团队乃至部门的kpi。为此，遇到生产故障后的第一要务是：恢复生产服务，即使不能完全恢复线上服务，也要想尽办法将对线上服务的影响降到最低。</p>\n<h4>填坑</h4>\n<p>‘填坑’——找到问题原因，根本上解决问题。</p>\n<p>在恢复线上服务，尽最大限度减掉对用户/公司/团队带来的影响后，我们需要彻查问题，搞清楚故障发生的根本原因，从根本上解决问题。通常情况下，‘填坑’和‘跳坑’是同步在做的，完成‘填坑’也就意味中‘跳坑’成功，但是也有一些紧急情况下的特别‘跳坑’方法，比如重启服务，或者服务降级/熔断等等，实际并未在当时完成‘填坑’，而是先采取非常规手段‘跳坑’，之后再慢慢‘填坑’。</p>\n<h4>避坑</h4>\n<p>‘避坑’——举一反三，消灭隐患。</p>\n<p>找到了根本原因，解决了问题之后，我们需要举一反三，以此及彼，想想在这个故障排查和处理过程中，那些环节存在弱点？那些流程/规范/制度需要优化？这类问题是否在其他系统或者团队中也存在？通过这样的反思和自我批评，形成一份线上事故报告，不断完善流程，避免再次踩坑，也在团队中交流经验，共同提高。</p>\n<h3>线上故障处理的思路</h3>\n<p>依据线上故障处理的目标及目标的优先级，线上排障的第一目标是恢复线上服务或者降低对线上服务的影响，关键点在于快速二字，在‘跳坑’-‘填坑’之后，再行回溯总结，以便‘避坑’。因此，可以将线上故障处理的步骤分为：</p>\n<ol>\n<li>故障发现</li>\n<li>故障定位</li>\n<li>故障排除</li>\n<li>故障回溯</li>\n</ol>\n<p>其中前三步是‘跳坑’行为，后面一步包含了‘填坑’和‘避坑’。</p>\n<p>上述步骤并不是说要从上到下顺序进行，建议<strong>在不乱阵脚的情况下，并行去做</strong>，因为通常线上故障后会紧急启动故障处理程序，运维、开发、测试、产品各个角色都会参与进来，这时候分工下去，并行去做，不断汇总消息，做出判断，以求快速排障，恢复服务。<strong>这个思路类似于操作系统的fork/join设计思想，目的在于提高效率</strong>。</p>\n<p>在无法快速找到故障原因的时候，需要果断跳过故障定位环节，直接进行故障排除，比如采用服务降级、服务器扩容等手段，确保对线上服务降到最低且可控。等到线上服务’撑’过去之后，我们再慢慢定位故障原因，根本上解决问题。</p>\n<p>下面我们会对这四个步骤进行详细说明。</p>\n<h3>故障发现</h3>\n<p>线上故障一般可以通过如下几种途径传递到开发/运维人员手中，按照从上到下的顺序，故障的严重程度依次变高。</p>\n<ul>\n<li>主动发现——可能是开发或者运维不经意间查看生产环境的error日志，或者例行检查监控项时，看到了一些异常的现象，进而发现了故障；</li>\n<li>系统监控告警——通常包括cpu、内存、io、tcp连接数、disk、线程数、GC、连接池等各个服务器指标异常，可能是服务器出现了异常，但是业务还未受到大面积影响；</li>\n<li>业务监控告警——如用户登录失败率增加，订单堆积量增大，则意味中系统的异常已经很严重，影响了业务处理；</li>\n<li>关联系统故障追溯——上游系统或者下游系统的故障处理邮件/电话追溯，可能和本系统有关系，而且情况已经变得很糟糕了，需要快速定位；</li>\n<li>生产事件上报——通常业务异常带来的影响传递到用户，再从用户传递到客服人员，再到技术人员手里，会存在一定时延，所以一旦有生产事件上报，这个时候严重性已经到了最高，技术人员的压力也会增大，因为会有领导的关注，产品经理的询问和催促，客户人员的焦虑带来的压力。</li>\n</ul>\n<p>上述途径传递过来的信息仅仅只是线上故障苗头，并非一定就发生了大规模的线上故障，所以首先需要确认的是这是不是一次线上故障？还是只是个例生产问题？是否和本系统有关系？一般来讲：‘<strong>系统监控告警</strong>’和‘<strong>业务监控告警</strong>’的情况下，大部分都和本系统有关，且可能是线上故障；而‘主动发现’和‘生产事件上报’则需要做甄别，可以根据上报事件个数或者问题复现的方式来评估是否是大规模线上故障，或者跟踪日志信息或者特定用户问题追溯来确定。至于‘<strong>关联系统故障追溯</strong>’的情况，首先不要慌，先从宏观上确定本系统服务正常，一般可以检查是否有服务器监控报警，是否有业务监控报警等来确定，如果上游或者下游提供了日志，可以通过日志进行追踪，从而确定本系统是否存在故障。</p>\n<p>因此在得到一些线上故障苗头之后，可以通过以下途径确定是否是线上故障：业务监控告警、上报事件个数、问题重现、服务器监控等。<strong>这些途径可以并行进行，灵活组合，有时候一个手段就能确定，有时候需要组合多个手段予以判定</strong>。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/05/3ab27a1c2ffd9bfc14defd2e824de301.png\"><img class=\"alignnone size-full wp-image-111082\" src=\"http://jbcdn2.b0.upaiyun.com/2017/05/3ab27a1c2ffd9bfc14defd2e824de301.png\" alt=\"1\"></a></p>\n<h3>故障定位</h3>\n<p>一旦确定是线上故障后，我们需要快速定位故障点，找到问题原因，以便对症下药，快速排除故障。</p>\n<p>故障定位是一个不断‘收集信息–假设–验证–尝试’的循环过程，基本思路：拿到线上信息，产生怀疑点，拿到更详细的信息，进行推理验证，必要时刻，找到可行的验证措施，进行可控的尝试，或者在测试环境进行业务测试重现，性能测试重现。</p>\n<p>可能存在的怀疑点有：</p>\n<ul>\n<li>新版本发布有问题</li>\n<li>潜在的程序bug被激发，比如在访问量暴增的情况下，并发bug被激发</li>\n<li>业务量暴涨</li>\n<li>遭遇攻击，如活动期间羊毛党刷积分等</li>\n<li>上游服务调用异常，如上游系统升级httpclient后，将长连接改为短连接</li>\n<li>下游服务异常，下游服务宕机</li>\n<li>网络问题</li>\n<li>服务器故障，如磁盘满，内存爆掉等</li>\n<li>应用故障</li>\n<li>数据库故障</li>\n</ul>\n<p>为此，可以通过如下几方面收集信息，以便支撑你的怀疑点：</p>\n<ul>\n<li>最近新版本的发布情况</li>\n<li>本服务的异常/error日志</li>\n<li>本服务的调用量变化情况，是否存在暴涨？</li>\n<li>本服务的吞吐量，是否出现下降？</li>\n<li>本服务的时延，是否出现突然增大？</li>\n<li>服务器TCP的链接情况，是否存在大量的CLOSE_WAIT？</li>\n<li>服务器的cpu使用率，是否突然飙升？</li>\n<li>服务器的disk，磁盘空间是否已经用完？</li>\n<li>服务器的内存，内存是否爆掉？</li>\n<li>数据库或者存储是否挂掉？</li>\n</ul>\n<p>很多故障并不是由于单一原因造成的，而是多个条件同时满足时才出现的，所以，需要多收集信息，综合得到的信息，产生怀疑点，快速推理和验证，最后找到问题点，定位到故障。这个过程中可以集合大家的力量，并行去check各个点，并快速反馈信息。</p>\n<p>由于组合情况众多，这里只将明显的故障定位场景列出，更多的需要总结归纳：</p>\n<ul>\n<li>发布了最新版本，且故障最早出现时间在版本发布之后，很大程度上时由于新版本发布带来的问题，可能是bug，也可能是部署出现问题；</li>\n<li>未发布新版本，业务访问量猛增，服务时延增大，吞吐量先上升后下降，到最后服务直接不可用，可能原因是：业务量暴涨/遭遇攻击/上游服务异常调用；</li>\n<li>未发布新版本，部分服务失败，服务错误率增加，业务访问量增加，可能原因是业务访问量增大激发了潜在的并发bug，或者出现了io瓶颈等；</li>\n<li>业务访问量并未增加，但是服务时延下降，吞吐量下降，服务错误率增加，且服务器TCP的CLOSE_WAIT增大，这时候需要怀疑下游依赖服务是否异常。</li>\n<li>业务访问量并未增加，服务大范围不可用，日志中出现大量数据库错，很明显数据库可能出现问题，或者应用的数据库连接池出现问题。</li>\n</ul>\n<p>不一而足，需要逐步积累。下图是对上面描述的总结。</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/05/bc642fb22060a447b8d45506991e1120.png\"><img class=\"alignnone size-full wp-image-111083\" src=\"http://jbcdn2.b0.upaiyun.com/2017/05/bc642fb22060a447b8d45506991e1120.png\" alt=\"1\"></a></p>\n<p>故障定位的初期，一般会先通过邮件+电话的方式进行沟通，如果几分钟之后事态变糟糕，且没有眉目，则需要紧急启动会议形式的联合排障，所有相关人员需要放下手头事情，集中到一个特定会议室进行联合排障。这样的好处也在于能够迅速共享信息，快速做出决策。联合排障人员通常会包括：开发、运维、测试、产品，主力应当是开发和运维，测试和产品需要帮忙快速确认一些东西，如复现问题，或者确认业务逻辑等。</p>\n<p>从上面可以看到，故障定位过程中，追求‘快速’二字，为此多项事情是并行去做的。为了避免出现群龙无首的慌乱局面，需要有一个主心骨坐镇，把握排障的方向并最终做出决策，这个人是master，需要冷静沉着，且要能调度尽可能多的资源，所以技术leader或者运维leader会比较合适。这个类似于分布式系统的设计思路。</p>\n<p>另外，在故障定位过程中，获得的线上一线信息需要通过某种形式记录下来，邮件往来是一种比较好的方式，在完成通信和信息共享的基础上，也无形中保留了现场。其他的信息包括：error log，dump文件，服务器各个指标的状态值等等。</p>\n<h3>故障排除</h3>\n<p>一旦定位到故障原因，对症下药地排除故障就不是什么难事了，具体的措施可以参考下图中的总结：</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/05/156a5fe139f4bed28cac290f01277592.png\"><img class=\"alignnone size-full wp-image-111084\" src=\"http://jbcdn2.b0.upaiyun.com/2017/05/156a5fe139f4bed28cac290f01277592.png\" alt=\"1\"></a></p>\n<p>这里需要特别指出一个特别的场景：无法定位故障的情况下如何迅速排除故障。</p>\n<p>很多时候无法及时找到故障原因，必须直接进入故障排除，这时候的思路就在于：尽最大可能降低线上服务影响了。可以采用的手段有如下几项:</p>\n<ul>\n<li>服务降级——定位到某些服务有异常，但不清楚异常出现的原因，直接将这些服务降级，确保其他服务不受影响；</li>\n<li>服务紧急扩容——无法定位到是哪些服务造成的，服务器资源彪升，扛不住压力时，紧急扩容服务器；比如恶意攻击、营销活动，秒杀等场景带来的突发情况；</li>\n<li>回退版本——有新版本发布，但是不能迅速确定是否和新版本有关系，先做版本回退，确保线上服务回到上一个稳定版本。</li>\n</ul>\n<p>还是那句话，故障排除的原则是：确保线上服务快速恢复，不能完全恢复的情况下，确保线上服务尽可能少地受到影响。</p>\n<h3>故障回溯</h3>\n<p>故障回溯的目的是在故障排除后，冷静地回溯整个线上故障的发现/定位/排除过程，找出流程中/架构中/制度中的缺陷，并将该缺陷消灭掉，同时推而广之到其他系统。在‘跳坑’–‘填坑’之后，我们需要通过故障回溯的过程达到‘避坑’的效果，即要保证自己能‘避坑’，也保证团队/公司能够避开类似的坑。</p>\n<p>故障回溯的过程，因人因团队而异，最重要的是要有严肃的‘形式’和最终的产出物。之所以提到严肃的‘形式’，是因为线上故障无小事，一定要让大家牢记在心。</p>\n<p>至于如何达到‘严肃’，可以参考如下形式：</p>\n<ul>\n<li>可以和kpi挂钩。慎用，可能会伤害到技术人员的心，造成‘懒政’现象——“多干多出事，少干少出事”出现；</li>\n<li>可以实施追责制度。同上；</li>\n<li>还可以进行邮件或者会议形式的讨论，广而告之。</li>\n</ul>\n<p>总之，故障回溯的最终的目标不是为了追责，更重要的是让大家长记性，避免后续再次踩坑，而且线上故障报告的产出物一定要有，一方面是经验的积累，便于分享，另一方面也让当事人撸清楚事件过程，吃一堑长一智。</p>\n<p>可以参考的一个流程如下：</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/05/a3208d6d159864ec984e0b1da271db73.png\"><img class=\"alignnone size-full wp-image-111085\" src=\"http://jbcdn2.b0.upaiyun.com/2017/05/a3208d6d159864ec984e0b1da271db73.png\" alt=\"1\"></a></p>\n<h3>线上故障处理的‘后勤保障’</h3>\n<p>前面谈了线上故障处理的目标、思路和步骤，回过头来看下，要快速准确地定位和排除线上故障，需要很多基础设施支撑，它们是线上故障处理的‘后勤保障’。结合上面的内容归纳总结如下：</p>\n<h4>完善的监控/告警体系</h4>\n<p>通过告警，能让我们迅速知道自己的服务出了问题，通过监控可以从时间维度进行对比分析，找到可疑点，进而定位故障。</p>\n<p>监控通常分为：</p>\n<ul>\n<li>服务器监控——针对操作系统资源使用情况(比如cpu使用率、内容使用率、磁盘空间、io、network等)，容器健康程度（内存使用情况、线程数、GC情况等），application健康程度的（服务的可访问性等）;</li>\n<li>服务监控——包括吞吐量、时延等，这些指标至少包括：最大值、平均值，通过这些指标可以判断单个服务的变化情况和健康程度；</li>\n<li>业务监控——包括访问量、错误率等，一个业务场景往往会包含多个服务调用，因此通过业务监控，可以发现一些关联问题。</li>\n</ul>\n<p>告警方面，需要根据实际情况和业务场景进行阈值设定，告警阈值的设定是一个动态调整的过程。</p>\n<p>监控系统最基本的需要保证：按照时间序列进行统计、对比。</p>\n<h4>完善的日志trace体系</h4>\n<p>在线上故障处理过程中，日志尤其重要，通过日志能够定位到问题或者bug细节。在分布式架构的系统中，多实例的部署导致日志分散在多台机器上，靠人肉查看耗时费力，效率低下；另一方面，业务发展壮大后，业务系统越来越多，系统间依赖越来越多，各个业务系统的日志需要通过唯一的标识串联起来，否则会出现信息断层的问题，日志变得无用。所以完善的日志trace系统非常必要。</p>\n<p>日志trace体系的几个关键点：</p>\n<ul>\n<li>有唯一的标识串联上下游系统日志</li>\n<li>能自动收集分布式应用日志</li>\n<li>日志收集时延不能超过10分钟（具体时间试实际情况而定，如果时延太长，日志没有多大意义）</li>\n<li>支持多种形式的查询/过滤/统计等</li>\n<li>可以看到时间序列上的变化趋势</li>\n</ul>\n<p>推荐使用开源的日志架构：logstash+elasticsearch+kibana。</p>\n<h4>完善的故障处理机制</h4>\n<p>线上故障处理的要点在于快速，所以需要有完善便捷的事件流转机制和故障处理机制来保证：生产事件能快速推送到相关责任人进行联合排除，保证事件排查过程中快速共享信息，快速完成决策。</p>\n<p>对于事件上报，一般的公司会有专用的通道给到一线客服人员，客户人员填报工单，上报事件，关键点在于事件处理中担任‘路由’角色的人员，他需要对业务系统比较熟悉，对于上报的问题能快速确定相关的业务系统和负责人，并通知到对方，这个角色既要熟知业务，也要熟知系统架构和组织架构，这个角色一般会交由专门人员处理，称之为‘二线’人员，或者由运维人员兼职。</p>\n<p>排查生产事件/故障时，推荐进行集中版本，便于快速共享信息，同时需要有一个master，以便把握大的方向，并快速完成决策。</p>\n<h3>总结</h3>\n<p>以上，对线上故障处理的目标、思路、步骤及基础设施进行了讨论，先总结如下：</p>\n<ul>\n<li>线上排障的第一目标是恢复线上服务或者降低对线上服务的影响，关键点在于快速二字，在‘跳坑’-‘填坑’之后，需要总结以便‘避坑’。</li>\n<li>一切的流程或者手段都是为‘快速’二字服务的，所以线上故障是最高优先级的任务，任何人需要第一时间予以响应；同时，尽早地反馈故障问题，尽早地集结各个角色，群策群力地进行排障值得提倡；这个过程中，需要有一位有‘威望’的master坐镇，主持大局；在保证有序推进的情况下，尽可能地并行地收集信息，进行尝试。这个有点分布式架构的味道了，master坐镇，slave并行干活，提高效率。</li>\n<li>必须要有一个‘严肃’的形式让当事人及旁观者‘吃一堑长一智’，线上故障处理报告是必须的产出物。</li>\n<li>为了更加高效的处理线上故障，需要有完善的基础设施支撑：监控/告警体系、日志trace体系、事件流转机制。</li>\n</ul>\n<p>对于线上排障的流程整理了一个大图，如下：</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/05/c4fd3a0b730cc16c2b83e9e44882bc53.png\"><img class=\"alignnone size-full wp-image-111086\" src=\"http://jbcdn2.b0.upaiyun.com/2017/05/c4fd3a0b730cc16c2b83e9e44882bc53.png\" alt=\"1\"></a></p>\n<h3>案例</h3>\n<p><a href=\"http://www.cnblogs.com/daoqidelv/p/6786649.html\">线上故障处理——大量异常堆栈日志输出影响服务可用性</a></p>\n<h3>参考资料</h3>\n<p>本文中部分观点来源于goole出版的《Google SRE》一书，这本书中有很多实用的且经过实践证明了的详尽的例子，该书的读书笔记可参考：《<a href=\"http://www.jianshu.com/p/60cb877d9409\">Google SRE读后感</a>》</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111081\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111081votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111081\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "comment_nums": 0, "praise_nums": "1", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/3ab27a1c2ffd9bfc14defd2e824de301.png"], "create_date": "2017-05-04", "url": "http://blog.jobbole.com/111081/", "front_image_path": "full/61e83f8220685c9a81e1f9e49c9a8861761868e5.jpg", "tags": "IT技术,运维"},
{"fav_nums": 4, "title": "有哪些命令行的软件堪称神器？", "url_object_id": "6eeea46b5cdc0967a25e60ee0aa5eac0", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.zhihu.com/question/59227720/answer/163594782\">int32bit（已授权转载）</a>   </div><p><b><a class=\" wrap external\" href=\"https://github.com/ggreer/the_silver_searcher\" target=\"_blank\" rel=\"nofollow noreferrer\">ag<i class=\"icon-external\"></i></a>：</b>比grep、ack更快的递归搜索文件内容。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1ff8lc6lm06j20go0azdig.jpg\" width=\"600\" height=\"395\"></p>\n<p><b><a class=\" wrap external\" href=\"https://github.com/jonas/tig\" target=\"_blank\" rel=\"nofollow noreferrer\">tig<i class=\"icon-external\"></i></a>：</b>字符模式下交互查看git项目，可以替代git命令。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1ff8lc7fx0uj20go09278u.jpg\" width=\"600\" height=\"326\"></p>\n<p><b><a class=\" wrap external\" href=\"https://github.com/dbcli/mycli\" target=\"_blank\" rel=\"nofollow noreferrer\">mycli<i class=\"icon-external\"></i></a>：</b>mysql客户端，支持语法高亮和命令补全，效果类似ipython，可以替代mysql命令。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1ff8lc83fejj20go08tq55.jpg\" width=\"600\" height=\"317\"></p>\n<p>jq: json文件处理以及格式化显示，支持高亮，可以替换python -m json.tool。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1ff8lc8s1rdj20go0ah0uv.jpg\" width=\"600\" height=\"377\"></p>\n<p><b><u><a class=\" wrap external\" href=\"https://github.com/koalaman/shellcheck\" target=\"_blank\" rel=\"nofollow noreferrer\">shellcheck<i class=\"icon-external\"></i></a>：</u></b>shell脚本静态检查工具，能够识别语法错误以及不规范的写法。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1ff8lc9h2ccj20go07mjs7.jpg\" width=\"600\" height=\"274\"></p>\n<div>\n<p><b><u><a class=\" wrap external\" href=\"https://github.com/google/yapf\" target=\"_blank\" rel=\"nofollow noreferrer\">yapf<i class=\"icon-external\"></i></a>：</u></b>Google开发的python代码格式规范化工具，支持pep8以及Google代码风格。</p>\n<p><b><u><a class=\" wrap external\" href=\"https://mosh.org/%23getting\" target=\"_blank\" rel=\"nofollow noreferrer\">mosh<i class=\"icon-external\"></i></a>：基于UDP的终端连接，</u></b>可以替代ssh，连接更稳定，即使IP变了，也能自动重连。</p>\n<p><b><a class=\" wrap external\" href=\"https://github.com/junegunn/fzf\" target=\"_blank\" rel=\"nofollow noreferrer\">fzf<i class=\"icon-external\"></i></a>：</b>命令行下模糊搜索工具，能够交互式智能搜索并选取文件或者内容，配合终端ctrl-r历史命令搜索简直完美。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1ff8lca3g0dj20go0c6wlj.jpg\" width=\"600\" height=\"438\"></p>\n<p><b><u><a class=\" wrap external\" href=\"https://github.com/facebook/PathPicker\" target=\"_blank\" rel=\"nofollow noreferrer\">PathPicker(fpp)<i class=\"icon-external\"></i></a>:</u></b>在命令行输出中自动识别目录和文件，支持交互式，配合git非常有用。</p>\n<p>运行以下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-590af4b47caed652977012\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit diff HEAD~8 --stat | fpp</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-590af4b47caed652977012-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-590af4b47caed652977012-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">diff </span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-o\">~</span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">stat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpp</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>\n</p></div>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1ff8lcanda0j20go08jdix.jpg\" width=\"600\" height=\"307\"></p>\n<p><b><u><a class=\" wrap external\" href=\"https://hisham.hm/htop/\" target=\"_blank\" rel=\"nofollow noreferrer\">htop<i class=\"icon-external\"></i></a>: </u></b>提供更美观、更方便的进程监控工具，<b><u>替代top命令。</u></b></p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1ff8lcbfk4dj20go096afc.jpg\" width=\"600\" height=\"330\"></p>\n<p><b><u><a class=\" wrap external\" href=\"http://axel.alioth.debian.org/\" target=\"_blank\" rel=\"nofollow noreferrer\">axel<i class=\"icon-external\"></i></a>：</u></b>多线程下载工具，下载文件时可以替代curl、wget。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-590af4b47cafa972503113\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\naxel -n 20 http://centos.ustc.edu.cn/centos/7/isos/x86_64/CentOS-7-x86_64-Minimal-1511.iso</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-590af4b47cafa972503113-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-590af4b47cafa972503113-1\"><span class=\"crayon-v\">axel</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//centos.ustc.edu.cn/centos/7/isos/x86_64/CentOS-7-x86_64-Minimal-1511.iso</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1ff8lcc5yl2j20go0eodmg.jpg\" width=\"600\" height=\"528\"></p>\n<p><b><u><a class=\" wrap external\" href=\"https://github.com/mmastrac/iterm2-zmodem\" target=\"_blank\" rel=\"nofollow noreferrer\">sz/rz<i class=\"icon-external\"></i></a>：</u></b>交互式文件传输，在多重跳板机下传输文件非常好用，不用一级一级传输。</p>\n<p><b><a class=\" wrap external\" href=\"http://cloc.sourceforge.net/\" target=\"_blank\" rel=\"nofollow noreferrer\">cloc<i class=\"icon-external\"></i></a>：</b>代码统计工具，能够统计代码的空行数、注释行、编程语言。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1ff8lccg7muj20go05bgmp.jpg\" width=\"600\" height=\"191\"></p>\n<p><b><a class=\" wrap external\" href=\"https://ccache.samba.org/\" target=\"_blank\" rel=\"nofollow noreferrer\">ccache<i class=\"icon-external\"></i></a>：</b>高速C/C++编译缓存工具，反复编译内核非常有用。使用起来也非常方便：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-590af4b47caff681315343\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngcc foo.c</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-590af4b47caff681315343-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-590af4b47caff681315343-1\"><span class=\"crayon-e\">gcc </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>改成:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-590af4b47cb05068062261\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nccache gcc foo.c</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-590af4b47cb05068062261-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-590af4b47cb05068062261-1\"><span class=\"crayon-e\">ccache </span><span class=\"crayon-e\">gcc </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><b>tmux：终端复用工具，替代screen、nohup。</b></p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1ff8lcdhubdj20go0afwic.jpg\" width=\"600\" height=\"375\"></p>\n<div>\n<div>\n<p><a class=\" wrap external\" href=\"https://neovim.io/\" target=\"_blank\" rel=\"nofollow noreferrer\">neovim<i class=\"icon-external\"></i></a>: 替代vim。</p>\n<p><b>script/scriptreplay: </b>终端会话录制。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-590af4b47cb08572817383\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nscript -t 2&gt;time.txt session.typescript # 录制开始\r\n# your commands\r\nexit # 录制结束</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-590af4b47cb08572817383-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-590af4b47cb08572817383-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-590af4b47cb08572817383-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-590af4b47cb08572817383-1\"><span class=\"crayon-v\">script</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">typescript</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 录制开始</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-590af4b47cb08572817383-2\"><span class=\"crayon-p\"># your commands</span></div><div class=\"crayon-line\" id=\"crayon-590af4b47cb08572817383-3\"><span class=\"crayon-v\">exit</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 录制结束</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>回放:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-590af4b47cb0c306698280\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nscriptreplay -t time.txt session.typescript</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-590af4b47cb0c306698280-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-590af4b47cb0c306698280-1\"><span class=\"crayon-v\">scriptreplay</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">typescript</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><b><a class=\" wrap external\" href=\"https://github.com/soimort/you-get\" target=\"_blank\" rel=\"nofollow noreferrer\">you-get<i class=\"icon-external\"></i></a>: </b>非常强大的媒体下载工具，支持youtube、google+、优酷、芒果TV、腾讯视频、秒拍等视频下载。</p>\n<p>还有mac专有的pbcopy/pbpaste：</p>\n<p>把命令行输出拷贝到系统粘贴板：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-590af4b47cb0f067807035\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncat test.sh| pbcopy</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-590af4b47cb0f067807035-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-590af4b47cb0f067807035-1\"><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pbcopy</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>把系统粘贴板内容拷到终端:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-590af4b47cb12161591115\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npbpaste</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-590af4b47cb12161591115-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-590af4b47cb12161591115-1\"><span class=\"crayon-v\">pbpaste</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>mac下的say命令支持多种语言(英语、普通话、粤语)文本朗读，支持各种销魂恐怖的语气。跑这个命令感受下，小心被吓着了：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-590af4b47cb15591298978\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor i in `say -v '?' | cut -d ' ' -f 1`; do echo $i &amp;&amp; say -v \"$i\" 'Hello World';done</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-590af4b47cb15591298978-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-590af4b47cb15591298978-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">say</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'?'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cut</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">' '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">say</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$i\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Hello World'</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">done</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>更具体的列表可参考：<a class=\" wrap external\" href=\"https://link.zhihu.com/?target=https%3A//github.com/int32bit/dotfiles\" target=\"_blank\" rel=\"nofollow noreferrer\">int32bit/dotfiles<i class=\"icon-external\"></i></a> 。</p>\n</div>\n</div>\n<p> </p>\n<h3>伯乐在线补充：</h3>\n<p>知乎原帖中还有另外一个朋友推荐了 <a href=\"https://github.com/nvbn/thefuck\" target=\"_blank\">The Fuck</a>。安装该工具后，在输入命令时如果手抖打错了，会有提醒。见下图：</p>\n<p><img src=\"http://ww2.sinaimg.cn/mw690/6941baebjw1exd7142tfrj20cw09x0w6.jpg\" alt=\"\"></p>\n<p>The Fuck 在 GitHub 上有 26k 多 star，它是如何实现的？请看开发者的文章《<a href=\"http://python.jobbole.com/82528/\" target=\"_blank\">热门 Python 应用 The Fuck 是如何工作的</a>》。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111072\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111072votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111072\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "comment_nums": 1, "praise_nums": "1", "front_image_url": ["http://wx2.sinaimg.cn/mw690/63918611gy1ff8lc6lm06j20go0azdig.jpg"], "create_date": "2017-05-03", "url": "http://blog.jobbole.com/111072/", "front_image_path": "full/2f706391ee65fdfc16b116b90f76185b162f1029.jpg", "tags": "IT技术,命令行"},
{"fav_nums": 1, "title": "一张优惠券引发的血案", "url_object_id": "9a6909f3616c2ea2b9dd982b5cc9605a", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/bjweimengshu\">玻璃猫</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/d24198d89a821452a421af6ae64b13c4.png\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/7def9437ba1d27381bc1d8d522825c3b.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/66bf1f49392cc2729a0d5cafaaf40cd8.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/5f0fa047a0e2b67a708e5e89909e012d.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/fc99049bd070406e907ca7a7b03fc2f8.jpeg\"></p>\n<p>一个月前——</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/09bc3864a82cd1c8f16f1c7edae1ddba.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/0ae3146a3cb106598ef79fad3f2916dc.jpeg\"></p>\n<p>整个优惠券中心分为前端和后端，小灰所负责的是后端RPC接口的开发。接口中包含“查券”和“领券”两个方法，项目大体结构如下图：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/318ace3b189049e62f11dfba8913af6d.jpeg\"></p>\n<p>两周后——</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/42ad521e5db9f2f628587bcbc4ab82f8.jpeg\"></p>\n<p>小灰：看，这是优惠券查询功能的效果！</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/e1b844b2f74eef1823d3f723c5021e71.jpeg\"></p>\n<p>小灰：看，这是优惠券领取功能的效果！</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/14e01e8b4326eca2c0177263eb083b61.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/748679d70e308d36cf5e5e442eebd30d.jpeg\"></p>\n<p>三天后——</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/adceb1aa90f1b7893c88bde770ec0c31.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/b477138a9ffb55307507de5bd8b0ca6e.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/6bbd3f7bdedfeb0fa43a79e8355351dc.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/aad1cef68792f2615646d6ecf8e6fc1f.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/edfb4c04847b5a4005dff11f628e45f1.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/154b75b87bff4cc056d217702f37d0f2.jpeg\"></p>\n<p>小灰原本的优惠券查询接口是这样实现的：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/fc64391201fe85da923378e79a60335e.jpeg\"></p>\n<p>优惠券列表在Redis中以List的形式存储，查询时的逻辑很简单：</p>\n<p>1.查询缓存，如果缓存存在，返回结果</p>\n<p>2.缓存不存在，查询数据库</p>\n<p>3.把查询数据库的结果循环放入缓存</p>\n<p>然而，当某个时间点缓存不存在，请求量又很大的时候，会出现<strong>缓存并发</strong>的问题。也就是多个线程会重复去查询DB，又重复去更新缓存。（注意，这并不是<strong>缓存击穿</strong>，很多人在这两个概念上混淆。）</p>\n<p>这其中重复查询DB是次要问题，而重复更新缓存则是主要问题。假如有两个线程同时进入上述的第三个阶段，各自进行rpush操作，那么最终会在优惠券列表的缓存中插入两组同样的数据。</p>\n<p>怎么解决呢？用Java的锁机制？显然不行，因为线上环境通常都是多个服务器组成的集群。于是小灰想到了利用<strong>分布式锁</strong>。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/095014b99c5dd133849989833bb76ef5.jpeg\"></p>\n<p>所谓分布式锁有很多种，可以利用ZooKeeper、MemCache、Redis来实现。其中Redis的方式比较简单，无非是利用一个服务器之间共享的Key，以及Setnx指令。</p>\n<p>当第一个线程执行Setnx，会存储对应的键值，相当于成功获得锁。当后续再有线程对同于的Key执行Setnx指令，则会返回空，相当于抢锁失败。同时，为了防止一个线程因意外情况而长久把持着锁，程序对Key设置了1秒的过期时间。</p>\n<p>归纳一下修改后的逻辑：</p>\n<p>1.查询缓存，如果缓存存在，返回结果</p>\n<p>2.缓存不存在，查询数据库</p>\n<p>3.争夺分布式锁</p>\n<p>4.成功获得锁，把查询数据库的结果循环放入缓存</p>\n<p>5.释放分布式锁</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/1beea94a72fb2d15e1c08cc483ef3533.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/7de5ac624d06a082fba5cae7a3588aa5.jpeg\"></p>\n<p>三天后——</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/79ba27f4cd5680b75005a725a1dcc537.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/0044500e143abcb925d4533225e64aad.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/183fd9b545ddc47c5a63b5f9276e280d.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/1073a937f6afe55bd10f8fd51637707b.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/72c0b99525b98fdd4667217b04fa3b1c.jpeg\"></p>\n<p>诡异的bug又重现了，因为小灰上次的改动仍然存在一个致命的漏洞。在这里我们假定缓存不存在，刚好有两个线程A和B一后一先进入到代码块。</p>\n<p>第一阶段，线程A刚开始查询优惠券缓存，线程B正尝试获取分布式锁：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/4d7d298409701592f1b7a53adc6d8786.jpeg\"></p>\n<p>第二阶段，由于缓存不存在，线程A开始查询数据库，线程B成功获得锁，开始更新缓存：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/3adf9ed881fad675b2e79d8c49d93be3.jpeg\"></p>\n<p>第三阶段，线程A尝试获得分布式锁，而线程B已经释放分布式锁：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/ab7d96c7be4d6ee33be1876ba8831e2e.jpeg\"></p>\n<p>第四阶段，线程A获得了锁，<strong>又一次</strong>更新缓存，而线程B已经成功返回：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/2d17073f0ce0d166a6a02e3cda641604.jpeg\"></p>\n<p>就这样，缓存被重复更新了两次，所以再次出现数据重复的bug。</p>\n<p>这种局面如何破解呢？其实不难，只需在线程成功得到锁以后，再次判断优惠券缓存的存在：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/71acc87a2e881836880ca644179f2a17.jpeg\"></p>\n<p>归纳一下修改后的逻辑：</p>\n<p>1.查询缓存，如果缓存存在，返回结果</p>\n<p>2.缓存不存在，查询数据库</p>\n<p>3.争夺分布式锁</p>\n<p>4.成功获得锁，再次判断缓存的存在</p>\n<p>5.如果缓存仍旧不存在，把查询数据库的结果循环放入缓存</p>\n<p>6.释放分布式锁</p>\n<p>这种二次判断存在性的机制有一个专门的名字，叫做<strong>双重检测</strong>。该方法在线程安全的单例模式中也常常被用到。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/f9ecbb65155916c904f27a8be9775fcf.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/dec0265a6c103b90338e8a18c7b5a6af.jpeg\"></p>\n<p>小灰的回忆告一段落——</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/6e05443ad29333f6d6971f625ccb228d.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/2fdf07d2f2c5816f8eafcaca4c7a5302.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/2097948c9c34eb94889851fa789aa37b.jpeg\"></p>\n<p><strong>几点补充：</strong></p>\n<p>1.文中所使用的分布式锁，其实并不是“正宗”的分布式锁，当线程争夺锁失败的时候，会直接返回查询DB的结果，而不会依靠<strong>自旋</strong>机制来等锁。</p>\n<p>2.为什么优惠券列表的信息要使用List类型来存入缓存，而不是把整个列表存为一个很长的Json字符串？这是由于业务需要，使用List在某些情况下更方便对单个优惠券信息进行修改（LSET指令）。</p>\n<p>3.为什么优惠券列表的信息不使用Redis的Set或者Hash数据类型来存储，实现自动去重呢？对于Set类型，去重前需要对比整个字符串是否完全相同，而每一张优惠券是一个较长的Json字符串，对比的效率会比较低。使用Hash倒是可以实现高效的去重，但并未在根本上解决重复更新的问题。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/2df4a3ede6e684f78858dfde0e7b118f.jpeg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111076\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111076votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111076\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu\">玻璃猫</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/7ce4028f2cece3294efcb3e5caa73af1.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            互联网公司的码农一枚，喜欢算法和面向对象设计。个人微信号：13522239721 个人订阅号：dreamsee321欢迎一起交流讨论！        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/bjweimengshu\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/bjweimengshu/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 82</a> · <a title=\"个人微信：bjweimengshu\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "comment_nums": 0, "praise_nums": "2", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/7def9437ba1d27381bc1d8d522825c3b.jpeg"], "create_date": "2017-05-04", "url": "http://blog.jobbole.com/111076/", "front_image_path": "full/c09cb16c79404789e48f2eba4301ba131665c0c0.jpg", "tags": "IT技术,分布式,缓存,高并发"},
{"fav_nums": 1, "title": "速度与激情 8 中的信息安全技术", "url_object_id": "6bef061e7ffcc6e8a94eaa102b81f084", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/26374755\">elknot（已获授权）</a>   </div><p>前言：本文中的技术仅供交流，如有疏漏还请大家批评指正</p>\n<p>14号跟女票下班之后直接去电影院看速8，当然看完速8之后并没有去速八而是直接回了家。首先对电影给个正面的评价，但是本人作为一个信息安全从业者，有必要扒一扒里面的黑客技术。</p>\n<p>里面涉及到黑客技术的东西主要有两个——天眼（The Eye）和僵尸车队（Zombie Cars）。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/63918611gy1ff87fb6lahj20ib0a8n51.jpg\" width=\"621\" height=\"347\"></p>\n<p>对于这两个东西其实和现实当中两项比较前沿的安全技术相关——汽车及物联网安全和攻击者溯源，对于汽车安全这一部分，我的基友闹心均<a class=\"member_mention\" href=\"http://www.zhihu.com/people/99baa09c00f17fffcdd281e48ebeb5e9\" data-hash=\"99baa09c00f17fffcdd281e48ebeb5e9\" data-editable=\"true\" data-title=\"@Selfighter\" data-hovercard=\"p$b$99baa09c00f17fffcdd281e48ebeb5e9\">@Selfighter</a>是砖家中的砖家，可惜人在HITB，所以我先很业余的说一些这方面的东西。</p>\n<p>首先我们先来说说智能汽车和非智能汽车，智能汽车其实就可以当做一个物联网设备来解决，也就是说智能汽车的攻击面和其他IoT设备的攻击面是差不多甚至更多的。</p>\n<p>其实汽车和计算机一样，内部通信依靠总线进行，汽车中的总线是CAN总线。CAN网络是由以研发和生产汽车电子产品著称的德国BOSCH公司开发的，并最终成为国际标准（ISO 11898），是国际上应用最广泛的现场总线之一。CAN总线协议目前已经成为汽车计算机控制系统和嵌入式工业控制局域网的标准总线，同时也是车载ECU之间通信的主要总线。当前市场上的汽车至少拥有一个CAN网络，作为嵌入式系统之间互联的主干网进行车内信息的交互和共享。CAN总线的短帧数据结构、非破坏性总线仲裁技术、灵活的通讯方式等特点能够满足汽车实时性和可靠性的要求，但同时也带来了系列安全隐患，如广播消息易被监听，基于优先级的仲裁机制易遭受攻击，无源地址域和无认证域无法区分消息来源等问题。特别是在汽车网联化大力发展的背景下，车内网络攻击更是成为汽车信息安全问题发生的源头，CAN总线网络安全分析逐渐成为行业安全专家聚焦点。如2013年9月DEFCON黑客大会上，黑客演示了从OBD-II控制福特翼虎、丰田普锐斯两款车型实现方向盘转向、刹车制动、油门加速、仪表盘显示等动作。汽车车内CAN网络安全问题当前主要通过安全漏洞的分析和各种攻击手段进行挖掘，因为汽车车内网络安全的脆弱性和威胁模型的分析尤为关键。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx3.sinaimg.cn/large/63918611gy1ff87fenipwj20gn09aqb3.jpg\"></p>\n<p>这么说来，只要抓住了CAN总线，我们就相当于是抓住了汽车的神经，也就能对汽车进行控制，那么攻击CAN总线会引发什么后果呢？</p>\n<p>第一个后果是失控：CAN总线主要应用之一是支持主动安全系统的通信，道路车辆行驶的时候，主动安全系统将是一把双刃剑，在它们发挥着不可替代的功能时候，但是考虑到主动安全系统的可操作和有能力调整正确的输入，也会引起驾驶者对主动安全系统的完全依赖。因此一个突然的故障会引起不可预知的危险后果。为了引发一个危险的条件，恶意的攻击者将会在CAN总线中注入错误帧，让主动安全系统失灵。例如，在牵引力控制系统里安装一个攻击，会造成车辆失去控制等危险。如果攻击者的目标是自适应巡航系统，将会导致汽车不会安驾驶者预期的那样停止。此外，为了最大可能的伤害汽车驾驶者，假如数据可以直接从CAN总线上获取，攻击者可以根据特定的条件，触发一个DoS攻击。例如汽车某一特定速度，特定的节气门百分比或者是某一确切的GPS位置等。</p>\n<p>第二个后果就是勒索：一个恶意的攻击者将在CAN总线中某一目标帧中设置攻击，这将会导致驾驶者无法控制节气门的位置从而不能让汽车移动。尽管这些不会必定发生危险状态，一个以金钱为目的的攻击者，将会利用车载娱乐系统的漏洞，停止汽车，并在娱乐系统屏幕上显示消息，车主为了重新获取汽车的操控权而去付赎金。</p>\n<p>第三个可能是盗窃：大部分现代昂贵的汽车门锁通过CAN连接到ECU来控制，通常通过OBD-II端口可连接。隔离负责控制锁/解锁车门的数据帧比逆向主动安全设备更简单、更快捷。因此，几分钟左右一个攻击者将会隔离负责锁车门的数据帧，编写他的设备程序-特定帧的DoS攻击，然后把设备插入到OBD-II的接口，阻止车门锁住。对于一个攻击者来说，这个攻击结果是可能的。通过低成本的花费就能进入到车内，随后就能够窃取车内任何贵重物品。</p>\n<p>长期以来，几乎整个汽车界都有这样的共识：<strong>CAN总线是没法保护的。两方面的原因，其一，ECU的计算处理能力不足；其二，车载网络的带宽有限</strong>。有些LIN总线使用的MCU甚至是16bit或8bit，但AES使用的加密算法只能处理16字节区块的数据，这意味着很多时候LIN总线根本就是处在“裸奔”的状态。所以汽车安全未来肯定是炙手可热的一部分。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/63918611gy1ff87hmv482j20fr08vjrq.jpg\"></p>\n<p>接下来我们说说天眼，其实天眼的目标很简单——我知道一个人的一部分信息，如何根据一部分信息去拼凑出一个完整的信息，比如他去过什么地方，干过什么事情，目的是什么，用了什么东西，也就是广义上的了解你的敌人。对于安全工作者来说，转化到现实当中的问题就是甲方安全团队在找到攻击者之后如何让攻击者不再攻击你？单单从防御的角度上来说，我们可以上规则、上设备，但是这样并不能从根本上解决问题。继续说回电影，其实《赤道》中香港、韩国两方面只希望把武器送走，确保不在香港交易同时回到韩国，这样就解决了这个问题。但是宋总不是这么想，宋总站在了更高的角度上，他不希望把香港变成真正的地下武器贩卖中心，也就是要把地下武器交易这个链条彻底打碎。从解决问题的角度上来看这两者都没错。</p>\n<p>回到正题，对于攻击者来说，攻击者一旦发起攻击就会在目标系统中产生数据，不管有用也好无用也罢，总之数据都会产生，诸如流量数据、操作日志、爆破记录、工具指纹、网络地址等信息。</p>\n<p>Phase 1：从日志分析的角度上来讲，既然我们有这么多的设备，有这么多的日志，我们要做的就是把这些想关的攻击向量和行为日志收集起来，统一到一起，看看有什么线索。</p>\n<p>Phase 2：既然我们已经收集到了很多的日志和数据，那么我们可以从日志中把这些信息拼凑成一个完整的攻击行为记录：即它是通过什么漏洞进来的，如何进来的，进来之后做了什么，对系统有什么影响。完完全全使之成为一个攻击的模型，这样的话也就完成了对入侵的推演。</p>\n<p>Phase 3：我们既然知道了他是如何进来了的，从甲方安全运营的角度来讲，我们需要确认其他机器当中是否有相同的漏洞和配置错误，要避免其它的人利用相同的方法入侵系统，毕竟不能在一个坑栽倒两次。</p>\n<p>Phase 4：我们现在有了攻击者的一些信息，我们是否可以通过外部威胁情报数据来看看这个攻击者是不是之前攻击过其他系统，攻击是不是有针对性，工具用的是进口的、国产的还是自己写的，是不是有其他的同伙或者帮手，他到底是怀揣着什么目的去攻击我们的系统。</p>\n<p>Phase 5：如果我们确定他的身份是恶意的，并且对我们的系统造成了很严重的影响，我们是不是应该知道这个人是什么来头，他的个人信息（虚拟身份和真实身份）我们是不是要了解，我们是不是应该去用法律手段搞他，等等。</p>\n<p>其实攻击溯源，其实是数据驱动的企业内部安全运营的一部分，需要大量数据的支撑以及分析才能找到攻击者，而企业内部我们见到最多的数据无非就是日志了，所以日志的分析和内网威胁情报的提取是非常重要的一环。</p>\n<p>针对安全运营来说，我个人认为所有的攻击者不可避免的都会产生操作日志，针对内网内的安全设备也好，非安全设备也好，肯定或多或少的存在日志。</p>\n<p>针对企业内部的日志，大体上可分为四类：安全设备日志、非安全设备日志、传感器日志和外部数据。</p>\n<p>对于追踪来说一般有这么三种套路：</p>\n<p>IP-＞域名-＞Whois信息-＞社交网络信息-&gt;真实信息：这个套路对于现在来说可能用处不是特别大，但是根据历史Whois信息也是可以得出一些启发性的结论的，当然这些威胁情报数据可能付费。</p>\n<p>IP-＞VPN-＞IP-&gt;社交网络信息：这种情况一般是大多数，解决方法是通过查询IP反连记录，解析操作和一些fingerprint获得他的虚拟身份信息，当然也是要收费的</p>\n<p>IP-&gt;botnet-＞IP-&gt;社交网络信息：这种广泛分布于挖矿、刷票、DDoS这种肉鸡类型的，可以想办法截获起botnet样本进行逆向分析，获取其c&amp;c服务器地址，然后对服务器进行反连查询。没错还是要收费的。</p>\n<p>安全设备日志：这些日志来源可以是硬件也可以是软件，首先就硬件来说注入IDS/WAF或者SIEM中的日志、硬件防火墙等等日志，软件日志包括防病毒软件、安全Agent、准入系统等软件系统的日志。这些日志一般都是攻击者进行攻击时会进行被动触发，这样的话可以检索到很多攻击信息，诸如使用的IP、端口、工具指纹等等。</p>\n<p>非安全设备日志：诸如路由器、交换机、网关、网闸等硬件设备以及操作系统、应用软件、服务器软件日志等软件日志，这些日志中可以分析出攻击者的目的，是为了单纯渗透玩一下还是想要通过控制机器作为跳板机进行进一步的渗透工作，还是说仅仅是安全部门进行扫描产生的日志。</p>\n<p>传感器日志：企业内部通常会部署一些蜜罐系统、流量传感器等，这些设备一方面可以有攻击预警和反横向渗透的效果，但是里面也会存在一些攻击者的行为，比如SSH蜜罐会存下攻击者在这台机器上的操作，流量传感器会对数据包进行DPI解析方便流量分析，这些数据中肯定残存着一些有用的信息可以帮助我们确定攻击者的行为、技能点，甚至可以进一步判断该攻击者的能力，是脚本小子还是大黑阔。</p>\n<p>外部日志：一些常用服务的日志，比如说邮件、DNS等日常服务的日志，这些日志可以帮我们确定攻击者是否是一种APT攻击，或者是是否是来种植Botnet的。同样可以确定攻击者的动机。</p>\n<p>说完了日志，我们紧接着可以说一下攻击者的动机判定，攻击者想要入侵一个系统肯定会对这个系统进行侦查，诸如端口扫描、脆弱性检测、exp测试等手段，这里面很容易和安全部门的安全常规巡检的日志起冲突，大多数公司都会把扫描机群放到白名单里。这样产生了类似的日志就会触发报警，我们可以进一步分析这些日志提取出一些攻击者的行为、动机等等，以及他的目的甚至他的技能点，我们都可以初步判断。</p>\n<p>通过对以上日志的分析，我们可以基本上确定攻击者是什么途径进来的，用何种攻击方式拿到机器权限，有没有执行什么敏感的操作，是否有进一步渗透的趋势，是不是在尝试提权之类的操作等等，这样我们就对攻击者有一个大概的了解。</p>\n<p>接下来我们就需要借助外部威胁情报的力量来获取攻击者的身份，我个人比较喜欢国内的微步在线和国外的PassiveTotal这两个平台，尤其是后者，数据比较全而且覆盖度很广。当然不差钱的各位可以选择去买威胁情报服务，更专业。</p>\n<p>简单说一下威胁情报可以帮我们干什么，威胁情报其实就是根据上面获得残破的攻击者画像变得完整，威胁情报一般可以获得这个攻击者有哪些常用的IP，这些IP分别都是干什么的，有没有什么社交信息，社交信息又有什么关联。举个不恰当的例子就是相当于你知道一个人的身份证号，然后警察用这个身份证号去查这个人有多少钱，资产有多少等等。这样你就可以获得一个较为完整的攻击者画像。</p>\n<p>到了这里其实我们知道了攻击者的信息，就可以选择怎么解决，拉倒办公室弹jj10分钟是一个解决方案，扭送到警察蜀黍那里也是解决方案，但是需要提醒大家注意执法力度和执法手段，不要知法犯法（逃。</p>\n<p>说到以上大家会觉得我偏题了，你娃不是说要讲天眼么，怎么扯了一大堆安全运营上的事儿，这跟天眼有什么关系。那么接下来的事情就和天眼有关系了：</p>\n<p>在电影中，飞车家族只需要输入一个名字就可以去找到这个人，确定他的位置，然后上门送温暖喝热茶。但是现实当中，重名的你懂得，所以我们现在从其他的地方下手：</p>\n<p>Part 1：长相，这里无非就是涉及到人脸识别技术，没什么好说的（其实是我不懂）</p>\n<p>Part 2：身份证号码，这个就比较重要了，身份证号码对于广大人民群众来说，变的机会基本为0，很多企业不管是干什么的也好都喜欢玩实名制，尤其是一些小的金融公司和P2P公司，总喜欢没事问你身份证号。鉴于我国信息泄露这个问题还是挺严重的，所以我们不能保证别人没有我们的身份证号。我们来说有了身份证号能干什么：先来造一张假的身份证，然后利用这张身份证（照片或者扫描件）去搞一些不需要实体身份证的东西，比如你懂得。这样我们就能把这个人的一些账户劫持了，能干啥你现在应该明白了。</p>\n<p>Part 3：手机号码，一般我们通信都用手机号码，手机号码泄露更是屡见不鲜，和身份证号一样，许多企业都是动不动就跟你要。手机号码泄露更是一件蛋疼的事情，骚扰电话短信不说，由于现在很多手机号码和业务是绑定的，也就是用手机号码就可以登录相关的业务，这样的话手机号码的泄露很有可能就会联系到相对应的身份，举个最简单的例子：手机号码绑定QQ号码，然后QQ号码可以查询群关系，之后通过群关系能搞出很多信息，后果你懂的</p>\n<p>Part 4：QQ号码，其实上面已经说了，QQ号码相当于虚拟版本的身份证号，很多东西都和QQ有关系，比如iCloud账号、游戏账号、甚至是一些信用卡账单啊什么的绑定的邮箱都是QQ的。QQ号码能查的东西那就太多了，上面就是个例子。</p>\n<p>Part 5：电子邮箱，这个在国内似乎用的比较少，但是企业内部的电子邮箱是讨论的重点，企业内部电子邮箱是很多攻击者最喜欢的地方，因为可以以此为突破口获取企业内部的一些信息。当年在甲方做安全运营的时候经常收到各种同时转发过来的钓鱼邮件，就是用来骗取Exchange邮箱账户的，这些对企业内部安全构成了严重的威胁。</p>\n<p>补充：有个网站可以查到某个邮箱/手机号注册了什么网站。。。。。</p>\n<p>所以，天眼的实现基础，其实是背后的数据在做支撑，数据，其实就是泄露的数据，民间收集的数据来源主要还是各大数据库泄露的SQL文件等，当然不排除有些万恶的黑产玩无间道，此处有句xxx我一定要讲。</p>\n<p>其实《速度与激情8》里面的黑客技术就现在看来是可以完全实现的，只是实现的成本有高有低，但是搞攻防的话，一定要站在攻击成本的角度上去考虑，安全无绝对，所以大家也没有必要为这些事情担心，安全研究院和厂商之间的互动越来越多也从侧面证明了现在大家对安全的重视，作为安全工作者，我们也非常愿意帮助厂商做好安全这一部分。先说这么多吧，此文仅作为科普，如需讨论细节还请回复或者发私信。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111029\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111029votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111029\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "comment_nums": 0, "praise_nums": "1", "front_image_url": ["http://wx4.sinaimg.cn/large/63918611gy1ff87fb6lahj20ib0a8n51.jpg"], "create_date": "2017-05-03", "url": "http://blog.jobbole.com/111029/", "front_image_path": "full/7e05c40245fcb12ade3bb6dfb7e71a7039b1ea92.jpg", "tags": "IT技术,安全"},
{"fav_nums": 0, "title": "机器是如何学会歧视的？机器学习中的偏见", "url_object_id": "fcd2fe182ded5d7a1921fe8212279623", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/maifansnet\">maifans</a> 翻译，<a href=\"http://www.jobbole.com/members/paradise_FD\">郑芸</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.scientificamerican.com/article/how-a-machine-learns-prejudice/\">Jesse Emspak</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：数据的选用和人的主观想法往往会在机器学习中产生偏见，例如，用于训练的数据大多是白人而导致讲黑人的照片识别为猩猩，或是研究人员认为可以通过长相来识别这个人生是不是罪犯（然而被证实是完全错误的）。因此，选取合适的数据以及设计好的算法对于机器学习来说非常重要，否则只能是“垃圾进，垃圾出”。</p>\n<blockquote>\n<div align=\"left\">AI 是从人类创造者那里学到了偏见，与它那刻板，冰冷的逻辑无关</div>\n</blockquote>\n<p>倘若 AI 接管了我们的生活，不大会发生人类陷入与冷酷使用 Spock 式逻辑的机器人军队的战争中，因为 AI 已在肉体上奴役我们了。相反， AI 程序已经通过机器学习算法为我们推荐喜欢的电影、在照片上认出哪个朋友可能会拒绝给你借钱、把警察带到你邻居家，或者告诉医生你需要节食。既然人类创造了这些算法，它们就容易产生偏见，从而导致糟糕的决策和更糟糕的结果。</p>\n<p>补充：Spock  是《星际迷航》中的一个人物。如下图。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1ff7zteih3pj218g0xcjvv.jpg\" width=\"500\" height=\"375\"></p>\n<p>这些偏差也直接让人们对人工智能日益依赖的现状产生担忧。因为人类设计的绝对“中立”的 AI 系统仍可能固化人们的歧视，而不是识破它。例如，尽管程序本身没有明显的考虑种族因素，但<a href=\"https://www.propublica.org/article/machine-bias-risk-assessments-in-criminal-sentencing\">算法将黑人嫌犯标记为更有可能在将来犯罪</a>，而使用该软件的执法机构遭到了批评。</p>\n<p>主要问题发生在两个方面：</p>\n<ul>\n<li>一、用于校准机器学习算法的数据有时不足；</li>\n<li>二、算法本身设计很糟糕。机器学习是软件开发人员利用大量与任务相关的数据训练 AI 算法的过程。</li>\n</ul>\n<p>算法在初始提供的数据中获得模式，使其能在新的数据中识别类似的模式。但是它并不总是按我们认为的那样工作，而且有时结果很糟糕。例如，2015年6月， Google 的照片分类系统将两名非裔美国人识别为“大猩猩”。尽管谷歌很快解决了这个问题，但是微软 AI 研究员凯特·克劳福德在<a href=\"http://www.nytimes.com/2016/06/26/opinion/sunday/artificial-intelligences-white-guy-problem.html\">《纽约时报》</a>上表示这个错误反映了 AI 中更大的“白人问题”。也就是说，用于训练软件的数据太依赖于白人照片，降低了其准确识别具有不同容貌的人的照片的能力。</p>\n<p>2017 年 1 月，Facebook 的用户新闻推送被大量虚假新闻淹没，也凸显了 AI 的偏差问题。 Facebook 的热门新闻算法是根据参与度（用户的点击或分享频率）来确定新闻排序的 ，没有考虑到新闻的真实性。 2016 年 11月初，有新闻媒体透露，一群马其顿青年在美国大选期间<a href=\"https://www.buzzfeed.com/craigsilverman/how-macedonia-became-a-global-hub-for-pro-trump-misinfo\">愚弄了Facebook的“新闻推送”算法</a>，以推送吸引右派选民的虚假新闻。 Facebook 表示已经修改了算法，并宣布了帮助 <a href=\"http://www.snopes.com/\">Snopes</a> 、<a href=\"http://factcheck.org/\">Factcheck.org</a> 、<a href=\"http://abcnews.go.com/\">ABC News</a> 和 <a href=\"http://www.politifact.com/\">PolitiFact</a> 清除明显的虚假新闻的计划。</p>\n<p>马里兰大学计算机系副教授 Hal DauméIII 说：“这有点像「俄罗斯坦克问题」”。 这个典故产出自20世纪80年代，机器学习发展的早期。虽然它的真实性存在疑问，但它有一定的代表性，而且常常被计算机系的老师引用。这个故事说，美国军方试图训练一台电脑来区分俄罗斯和美国坦克的照片。 Daumé解释说：“它们的分类准确度非常高，但俄罗斯坦克的所有照片都模糊不清，而美国坦克是高清晰度的。” 该算法不是识别坦克，而是学习区分模糊和清晰的照片。</p>\n<p>尽管有这些已知的缺陷，研究人员最近开发了一种算法，可以通过面部识别技术来辨认罪犯。 中国上海交通大学研究人员吴晓琳（音译，以下简称吴）和张希（音译，以下简称张）使用了一个有 1856 张面部照片的数据库训练机器学习算法，其中 730 人是罪犯，另外 1126 人不是。 在分析了 90％ 的图片后，AI 能够正确地识别剩余 10％ 照片中的罪犯。</p>\n<p>该算法将具体的面部特征与罪犯相关联。例如罪犯的眼角、嘴唇曲率和鼻尖更有可能存在特定的空间关系。吴说，他也认同如果一个人有这些特征，不能说这个人更可能是罪犯。 吴同时发现罪犯的面孔差异较大，而非罪犯往往具有相似的面部特征。</p>\n<p>吴继续使用以前没有看过的不同的照片来测试算法，发现它多半情况下可以正确识别罪犯。研究人员试图通过只使用没有面部毛发和疤痕的中国青年或中年男子的面部图片进行训练和测试其算法来避免偏差。</p>\n<p>吴说：“我本来想证明面相学是错的”，他指的是基于面部特征评估性格的有数百年历史的伪科学。 “结果却令我们大吃一惊。”虽然这项研究似乎可以验证了面相学的某些方面，但吴承认，使用这种技术来识别罪犯将是“疯狂的”，没有计划在执法机关中应用。</p>\n<p>其他科学家说吴和张的发现可能会强化现有的偏见。 Google 机器学习领域的首席科学家 Blaise Agüera y Arcas 指出，司法系统决定受试者的犯罪行为，但它执行着人类有偏见的决策（或许是潜意识的）。论文的核心问题是它依赖这一系统“作为标记犯罪分子的依据，然后基于人类的判断得出结论：机器学习是无偏见的。” Agüera y Arcas 补充说。</p>\n<p>研究计算机视觉的华盛顿大学数学系助理教授 Kyle Wilson 如是说：「吴和他的同事“直接得出结论，他们发现了自然界的一个潜在的模式 —— 面部结构可以预示犯罪行为。这是一个非常愚蠢的结论。」他还表示，这个算法可能只是人类的偏见在一个特定的司法系统中的反映，并且在其他国家也可能有同样的问题。 Wilson 说：“基于偏见在刑事司法系统中的表现，相同的数据和工具可以用来更好地了解（人的）偏见。 而不是教一台电脑来重现这些人类的偏见。”</p>\n<p>还有人说，通过解释电脑学习的模式中的错误，可以改进技术来消除人的偏见。瑞士 AI 实验室 Dalle Molle 人工智能研究所的科学主任 Jürgen Schmidhuber 说，人工智能系统在学习时会犯错。事实上这是肯定的，所以称之为“学习”。他指出，电脑只会从你给出的数据中学习。“你不能消除所有这些偏见的来源，就像你不能消除人类中的偏见来源，”但他补充说，首先承认问题，然后确保使用好的数据，并把算法设计好；提出正确的问题至关重要，或者记住程序员的一句老话：“垃圾进，垃圾出（Garbage in, garbage out）”。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111050\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111050votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111050\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/maifansnet\">maifans</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/maifansnet\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            软件工程师，关注人工智能，关注医疗器械。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/maifansnet\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/maifansnet/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/maifansnet/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 10</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "comment_nums": 0, "praise_nums": "1", "front_image_url": ["http://wx1.sinaimg.cn/mw690/63918611gy1ff7zteih3pj218g0xcjvv.jpg"], "create_date": "2017-05-03", "url": "http://blog.jobbole.com/111050/", "front_image_path": "full/f8126bc9d551925f193df7b36fe58420631e3a82.jpg", "tags": "IT技术"},
{"fav_nums": 0, "title": "也许 MySQL 适合 Uber，但它不一定适合你", "url_object_id": "be751ac65d35e4101c02be75598af3e3", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/LW\">LW</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://dzone.com/articles/on-ubers-choice-of-databases\">Markus Winand</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：Markus Winand 是数据库专家，著有《SQL Performance Explained》一书。2013 年 Uber 从 MySQL 迁移到 PostgreSQL，而在 2016 年 8 月，Uber 工程博客发文称他们从 PostgreSQL 迁回 MySQL。当时在业内引发热议，Markus 写下了这篇文章来回应。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/large/63918611gy1ff75v6yo2dj20bz072q38.jpg\"></p>\n<p>你可能听说了 Uber 从 PostgreSQL 迁移到 MySQL 。这对于他们来说，或许是一个好的迁移，但是这未必适合你。且听我说来。</p>\n<p>2016 年 8 月，Uber 发表了一篇名为《<a href=\"https://eng.uber.com/mysql-migration/\" target=\"_blank\">为什么 Uber 工程从 PostgreSQL 迁移到了 MySQL</a>》的文章。我并没有立即阅读原文，因为我的内心深处告诉我应该做一些本地的改进。在如此做的过程中，我的邮箱塞满了问题，比如“难道 PostgreSQL 真的有这么差劲吗？”我知道  PostgreSQL 并没有如此差劲，因此这些邮件使我想知道，原文到底写了些什么鬼玩意。这是一篇企图理解 Uber 的文章。</p>\n<p>在我看来，Uber 的文章基本上在说他们发现 MySQL 比 PostgreSQL 更适合他们的环境。然而，原文在传递这一消息时却表现的非常差劲。举例来说，原文并没有写“  PostgreSQL 在 update-heavy 的使用场景下有一些局限”，而是写到“它对于写入（write）来说是一个非常低效的架构”。当你没有 updata-heavy 的使用场景时，不必担心 Uber 的文章中描述的问题。</p>\n<p>在本文中，我将会解释：①为什么我认为 Uber 的文章并不能作为我们在选择数据库的一个普适性建议，②为什么 MySQL 仍旧适用于 Uber，③为什么这样的成功迁移案例可能会引起更多的问题，而不是扩展了数据库。</p>\n<h3>在更新方面的问题</h3>\n<p>Uber 的文章所出现的第一个问题是， 在更新表中的行时，PostgreSQL 通常需要更新表上的所有索引，原文对这方面做了大篇幅的描述，但细节又不够充分。另一方面，对于具有 InnoDB 的 MySQL 来说，只需要更新那些包含有更新列的索引。在更新改变了非索引列之时（原文中的「Write Amplification」部分），PostgreSQL 的方法需要占用更多的磁盘 IO。如果这对 Uber 来说是一个大问题，那这些更新对于他们来说，或许是其整个工作量中的很大一部分。</p>\n<p>然而，我有一些猜测，是 Uber 文章并没有提到的。原文并没有提及 PostgreSQL 的 Heap-Only-Tuples( HOT )。从 <a href=\"https://github.com/postgres/postgres/blob/master/src/backend/access/heap/README.HOT\" target=\"_blank\" rel=\"nofollow\">PostgreSQL</a> 源码来看，HOT 对于一些特殊场景非常有用，即“当一个元组进行了重复更新时，不需要对它的索引列进行更新”。在这个场景中，如果新的行版本能够和之前的版本存储在同一个页面中，PostgreSQL 能够做出一些不需要触及任何索引的更新。后一种情况可以使用  <a href=\"https://www.postgresql.org/docs/9.2/static/sql-createtable.html#SQL-CREATETABLE-STORAGE-PARAMETERS\" target=\"_blank\">fillfactor</a> 来进行调谐。假设 Uber 的工程认为 HOT 不能够解决他们的问题，是因为这些频繁的更新影响了不止一个索引列。</p>\n<p>这个假设也在文章中的下列语句得到了支持：“如果我们有一张定义了十几个索引的表，那么只覆盖了一个指标的领域的更新就必须涉及到整整12个指标来反映新的行中的 ctid ”。它明确地指出“只覆盖了一个指标，”只有一个索引这是一种极端情况，否则 PostgreSQL 的 HOT 是可以解决这一问题的。</p>\n<p>【旁注：我比较关心他们所拥有的索引的数量能否减少— <em><a href=\"http://winand.at/index-design&amp;utm_medium=UTILt&amp;utm_compaign=201607-uber\" target=\"_blank\" rel=\"nofollow\">index redesign</a>  </em>是我的一个挑战。无论如何，对于那些使用的很少但在使用时又非常重要的索引来说，这是完全有可能的。】</p>\n<p>看起来他们似乎运行着许多更新，这些更新改变了不止一个索引列，但这和表中所有索引相比来说，这算不上啥。如果这是一个主要的用例，那么原文建议用 MySQL 来取代 PostgreSQL 就能够说得通了。</p>\n<h3>关于 Select 的问题</h3>\n<p>还有一个关于他们用例的声明引起了我的注意：原文解释了 MySQL/InnoDB 使用了 clustered indexed ，并且承认了“这种设计意味着在做二次关键值查找时和 Postgres 相比 InnoDB 的优势并不明显”。关于这个问题（the clustered index penalty），我之前写过在 SQL Server 环境下的文章。</p>\n<p>他们写到 clustered index penalty 的优势很小，这引发了我的兴趣。在我看来，当你运行了很多使用二次索引的查找时，这个优势是很大的。如果对于他们来说这总种优势很小，那这可能说明这些索引使用得很少。这将意味着他们在大多数情况下使用了 primary key 来进行查找（那么就不需要付出 clustered index penalty 了）。注意我写的是“查找”而不是“选择”。这其中的原因在于 clustered index penalty 会影响具有 where 字句的声明，而不仅仅是选择。这也意味着高频率的更新大多基于primary key。</p>\n<p>最后，还有关于查询的问题：他们没有提到PostgreSQL在  <a href=\"https://wiki.postgresql.org/wiki/What&amp;apos;s_new_in_PostgreSQL_9.2#Index-only_scans\" target=\"_blank\">index-only scans</a> 方面的限制。尤其是在更新比较多的数据库，安装 PostgreSQ L的 index-only scans  没有多大用处。我甚至说过这是唯一影响我大多数客户端的问题。我在 2011 年已经在博客上写过这个问题。2012 年， PostgreSQL 9.2 在 index-only scans 获得了一些有限的支持（这些工作大多服务于静态数据）。2014 年我甚至在 PgCon 提出了我关注的一个方面。然而， Uber 并没有抱怨这个问题。选择速度对于他们而言并不是问题。我猜测查询速度有运行在  replicas 上的选择进行解决（如下所示），并且可能被大多数 primary key 所限制。</p>\n<p>如今，他们的使用案例看起来似乎更加适合一个键/值存储。并且 Innodb 是一个很坚实和流行的键/值存储。这里甚至有一些包将 InnoDB 和一些（非常有限的）的前端 SQL 绑定：我认为 MySQL 和 MariaDB 是非常流行的两个。但是认真地说，如果你需要一个键/值存储并且恰巧想运行一个简单的 SQL 查询， MySQL （或者 MariaDB ）是合理的选择。我猜测这至少比任何随机的 NoSQL 键/值存储要好，它们往往只提供一些更加有限的 SQL-ish 查询语句作为开始。Uber ，从另一个方面来说仅仅在 InnoDB 和 MySQL 上层建立了他们自己的东西（“<a href=\"https://eng.uber.com/schemaless-part-one/\" target=\"_blank\" rel=\"nofollow\">Schemaless</a>”）。</p>\n<h3>关于索引再平衡（Rebalancing）</h3>\n<p>关于原文谈索引，我最后再说一个方面：它在 B-tree 索引语句中使用了“再平衡”这个词。它甚至链接到了维基百科上词条 “<a href=\"https://en.wikipedia.org/wiki/B-tree#Rebalancing_after_deletion\" target=\"_blank\" rel=\"nofollow\">Rebalancing after deletion</a>”。不幸的是，维基百科词条解释并不普遍适用于数据库索引，因为维基百科上所描述的算法维持了每个节点至少是 half-full 的要求。为了提高并发性， PostgreSQL 使用了<a href=\"http://www.csd.uoc.gr/~hy460/pdf/p650-lehman.pdf\" target=\"_blank\" rel=\"nofollow\">Lehman, Yao variation of B-trees</a>，其升高了要求并且因此允许稀疏索引。作为一个旁节点，PostgreSQL 仍旧移除索引中的空白页（参见<a href=\"https://www.pgcon.org/2016/schedule/attachments/434_Index-internals-PGCon2016.pdf\" target=\"_blank\">“ Indexing Internals” 幻灯片第 15 页</a>）。然而，这仅仅只是一个次要问题。</p>\n<p>真正使我担心的是这句话：“B-tree 有核心方面，必须周期性再索引（rebalancing）…”，看到这里，我想声明这不是一个每天运行的周期性的过程。索引平衡是和每一次单独的索引变化一同维护的（或许更严重，对吗？）。但原文继续写到“…当子树移动到新的 no-disk 位置时，这些 rabalancing 操作会彻底改变树的结构”。如果你现在认为“rebalancing”包含了大量的数据移动，那你就误解了它。</p>\n<p>一个 B-tree 中的重要操作就是结点分裂。正如你所猜想的那样，结点分裂发生在一个结点不能主持属于这个结点的一个新条目。给你一个近似数，这可能在 100 次插入中发生一次。结点分裂分配新的结点，将一般的条目移动到新的结点并将新结点和它的前、后以及父结点连接起来。这就是 Lehman ， Yao 节省了大量锁定的地方。在某些情况下，新的结点不能直接加入到父结点中，因为父结点没有足够的空间来让新结点加入。在这种情况下，父结点进行分裂并重复所有的过程。</p>\n<p>在最糟糕的情况下，分裂泡沫会到达根结点，它也会进行分裂，并且会在其之上产生一个新的根结点。在这种情况下，一个 B-tree 将会增加深度。请注意，根结点的分裂有效转变了整棵树，并且因此保持了平衡。然而，这并不包括许大量数据的移动。在最差情况下，它可能会在每个曾经（level）上影响到三个节点和一个新的根结点。更确切地说：根结点分裂的最差情况，可能在一个十亿的插入中发生大约 5 次。在另一种情况下，它不需要遍历整棵树。总的来说，索引的维护不是“周期性的”，甚至不会发生的很频繁，并且永远不会改变整棵树的结构。至少在物理存储单元不会这样。</p>\n<h3>关于物理复制</h3>\n<p>我的下一个关注点是原文有关于 PostgreSQL 的物理复制（Physical Replication）。原文谈到「索引再平衡」话题的原因是 Uber 曾经遇到了 PostgreSQL 的复制错误，这导致了下游服务器的数据毁损。（这个错误值“影响了 Postgres  9.2 的一些特定版本并且已经修复了一段很长时间”）。</p>\n<p>因为 PostgreSQL 9.2 只在 core 提供物理复制，复制错误“只造成了树的很大一部分变得彻底无效。”具体解释为：如果一个结点分裂进行错误的重复，那么它就不能指向正确的子结点，这些子树将会变得无效。这是绝对正确的，正如其他警言“如果存在一个 Bug，那么不好的事情就会发生”。你不需要改变大量的数据，就可以打破树的结构。一个单独的坏指针就足够了。</p>\n<p>Uber 的文章提到了其他关于物理复制的情况：大量的复制流量—一部分由于更新带来的编写增幅—并且故障时间需要更新到新的 PostgreSQL 版本。如果第一个对于我而言是由意义的，那么我是不能评论第二个的（但是这里仍有 <a href=\"https://www.postgresql.org/message-id/20160727002711.GI4028%40tamriel.snowman.net\" target=\"_blank\" rel=\"nofollow\">statements on the PostgreSQL-hackers mailing list</a> ）。</p>\n<p>最后，原文也声明了 Postgres 并没有真正的 MVCC 支持副本。幸运的是，原文链接到了 PostgerSQL 的文档，里面这个问题得到了解释。这个问题基本上是主机并不需要知道副本做了什么，并且因此会删除数据，而这些数据仍然需要副本来完成查询。</p>\n<p>根据 <a href=\"https://www.postgresql.org/docs/9.2/static/hot-standby.html#HOT-STANDBY-CONFLICT\" target=\"_blank\" rel=\"nofollow\">PostgreSQL 官方文档</a>，有两个办法可以处理这个问题：</p>\n<p>1.为可配置的超时延迟复制流的应用，以便读取事务有机会完成。如果查询没有按时完成，杀死这个查询，并且继续应用这个复制流。</p>\n<p>2.配置副本，把所有正在运行的查询，反馈送回到主机（master），这样一来主机并不需要清空行版本（row versions），恰好这些行版本在一些从属（slave）中仍然需要。Uber 的文章对第一个版本制定了规则，但根本没提第二个版本。相反，原文指责了 Uber 的开发人员。</p>\n<h3>关于开发者</h3>\n<p>以荣誉之名引用这段话：“举例来说，开发者有一些数据需要将发送给用户。取决于代码是如何写的，这些代码可能隐含有一个数据库事务，同时执行不相关的 I/O 阻塞，事实上是许多工程师都不是数据库方面的专家，因此不能总是理解这些问题，尤其是当使用 ORM 时，ORM 隐藏了许多底层细节，比如 open transactions 。”</p>\n<p>不幸的是，我理解甚至同意这个评论。但是我不认同“许多工程师不是数据库，是因为每一个开发人员接触 SQL 是需要了解 transaction 的 ，不只数据库专家。”</p>\n<p>鉴于对开发人员进行 SQL 培训是我的主要工作。我在各种规模的公司做过这件事。如果说我能确定一件事，那就是和数据库相关的知识低的离谱。比如在刚刚提到的“open transaction”，我能确定的是，很少有开发人员知道只读事务是真事。大多数的开发人员只知道 事务可以用于回写。我遇到太多这种误解了，所以我准备了<a href=\"http://www.slideshare.net/MarkusWinand/sql-transactions-what-they-are-good-for-and-how-they-work\" target=\"_blank\">幻灯片来解释</a>。</p>\n<h3>关于成功</h3>\n<p>这是我想写的最后一个问题。一个公司雇佣的员工越多，他们的资质就越趋于平均。夸张一点说，如果你雇佣了整个星球上的人员，你将会拥有绝对的平均水平。雇佣再多的人，只是增加了公司的规模。</p>\n<p>这里有两种方法来击败这种比率：</p>\n<p>1、只雇佣最好的员工。这个方法最难的部分就是，当没有高于平均资质的候选者时，需要等待。</p>\n<p>2、雇佣一般的员工，然后在工作上培训。这对于新员工来说，需要一段很长的热身时间，并且可以结合现有员工进行培训。这两个方法的共同问题就是需要时间。如果你没有时间——因为你的公司在快速增长——你就不得不接受平庸，接受一些不是很了解数据库的人（ <a href=\"http://use-the-index-luke.com/blog/2014-02/results-three-minutes-sql-performance-quiz\" target=\"_blank\" rel=\"nofollow\">empirical data from 2014</a> ）。换句话来说：<strong>对于一个快速增长的公司来说，技术比人更容易改变。</strong></p>\n<p>正如随时间改变着的需求，成功的因素也会影响技术栈。在初期阶段，创业公司需要创造性的技术，即可以立即获得并且足够灵活来用于业务中。 SQL 一个比较好的选择，因为它确实灵活（你可以用任何方法来查询你的数据）并且很容易找到理解 SQL 的人，哪怕只对 SQL 有一点点了解。好了，那么就开始吧！然而对许多—或许大多数公司来说，故事就在这里结束了。即使他们比较成功并且他们的公司成长了，他们也可能在 SQL  的局限中永远处于原地踏步。Uber 不这样。</p>\n<p>一些幸运的创业公司最终从 SQL 蜕变。随着这种情况的发生，他们会有更多的机会访问资源并且然后…一些奇妙的事情发生了：他们意识到，如果他们开发一个只为自己使用的专用系统来取代通用数据库，他们就可以解决许多问题。这就是一个全新 NoSQL 数据库诞生的时刻。在 Uber ，他们将之称为 <a href=\"https://eng.uber.com/schemaless-part-one/\" target=\"_blank\" rel=\"nofollow\">Schemaless</a> 。</p>\n<h3>关于 Uber 的数据库选择</h3>\n<p>直到现在，我相信 Uber 没有像他们的文章所建议的使用 MySQL 取代 PostgreSQL 。看来他们确实在一些特定的方法上替换了 PostgreSQL ，而这些方法恰好是 MySQL / InnoDB 所支持的（在当时）。看来原文只是解释了为什么 MySQL/InnoDB 比 PostgreSQL 更好地支持 <a href=\"https://eng.uber.com/schemaless-part-one/\" target=\"_blank\" rel=\"nofollow\">Schemaless</a> 。对于在用 Schemaless 的人来说，采纳他们的建议！不幸的是，原文并没有明确这一点，因为它并没有提及，和 2013 年从 MySQL 迁移到 PostgreSQL 相比，他们的需求是如何随着 <a href=\"https://eng.uber.com/schemaless-part-one/\" target=\"_blank\" rel=\"nofollow\">Schemaless</a> 的引进而改变的。</p>\n<p>可悲的是，Uber 那文章留在读者脑海中的唯一事情，就是 PostgreSQL 很差劲。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111058\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111058votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111058\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/LW\">LW</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/LW\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/dc457710ff43112ee687b7549232ecd9.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            热爱编程 热爱生活        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/LW\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/lw/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/LW/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 10</a> · <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/echo92\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "comment_nums": 0, "praise_nums": "1", "front_image_url": ["http://wx3.sinaimg.cn/large/63918611gy1ff75v6yo2dj20bz072q38.jpg"], "create_date": "2017-05-02", "url": "http://blog.jobbole.com/111058/", "front_image_path": "full/446dd897d21f90a4d65dbceb65e1c3099aed6f04.jpg", "tags": "IT技术,MySQL,PostgreSQL,数据库"},
{"fav_nums": 0, "title": "DevOps 发展的 9 个趋势", "url_object_id": "df9a3ff79cd621cf19fbd8cb5faf6985", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<p>DevOps包含了太多方面的技术和实践，很难通过一个统一的工具链来描述其发展。即便如此，我们仍然可以从ThoughtWorks技术雷达的条目变动中看出一些趋势。今年，我有幸作为主编参与了最新一期技术雷达的译制，作为DevOps的爱好者，十分高兴能在这一过程中看到DevOps未来发展的几个趋势，总结成了这篇文章。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/1-DevOps.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/1-DevOps-1024x426.jpg\" alt=\"\" width=\"700\" height=\"291\"></a></p>\n<h3>趋势1：微服务目前仍然是DevOps技术应用和发展的主要领域</h3>\n<p>微服务将单块应用系统切割为多个简单独立的应用。从技术上说，这是通过工具把应用程序的内部复杂度转化为外部复杂度，需要一系列工具支撑微服务本身以及服务之间的通信。从组织上说，微服务团队要满足“快速发布，独立部署”的能力，则必须具备DevOps的工作方式。</p>\n<p>如何拆解微服务一直是微服务技术应用的最大难点之一，<strong>领域驱动设计</strong>是比较理想的微服务拆解方法论。<strong>社会化代码分析</strong>帮助团队通过更精确的数据找到更加合适的拆分点。<a href=\"https://codescene.io/\">CodeScene</a>是一个在线服务，它能帮助识别出热点和复杂且难以维护的子系统，通过分析分布式子系统在时间上的耦合发现子系统之间的耦合。此外，它还能帮你认识组织中的康威定律，这会大大降低微服务解耦的难度。</p>\n<p>此外，微服务系统本质上是一个分布式系统，分布式系统之间的通信一直是很重要的问题。本期介绍的 <a href=\"http://docs.confluent.io/3.0.0/streams/\">Kafka Streams</a> 和 <a href=\"http://opentracing.io/\">OpenTracing</a> 就是这类技术的条目。Kafka作为一个成熟的分布式消息系统已经被广泛采用，而Kafka Streams则将最佳实践以“库”的方式呈现给开发人员，使得操作Kafka更加自然和简单。而OpenTracing则弥补了跨越多个微服务之间请求追踪的空白。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/2-OpenTracing.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/2-OpenTracing-1024x643.jpg\" alt=\"\" width=\"700\" height=\"440\"></a></p>\n<p>另一方面，<strong>无服务器风格的架构（Serverless architecture）</strong>把DevOps技术在微服务领域的应用推向极致。当应用程序执行环境的管理被新的编程模型和平台取代后，团队的交付生产率得到了进一步的提升。一方面它免去了很多环境管理的工作，包括设备、网络、主机以及对应的软件和配置工作，使得软件运行时环境更加稳定。另一方面，它大大降低了团队采用DevOps的技术门槛。</p>\n<p>然而，端到端交付以及微服务中的函数管理问题日渐突出。尽管<a href=\"https://aws.amazon.com/cn/api-gateway/\">AWS API gateway</a>和<a href=\"https://aws.amazon.com/cn/lambda/\">AWS Lambda</a>几乎成了Serverless架构的代名词，但这二者结合的开发者体验并不佳。于是出现了<a href=\"https://serverless.com/\">Serverless framework</a>和<a href=\"https://claudiajs.com/\">CLAUDIA</a>这样的管理工具。</p>\n<p>AWS Lambda带来的优势也深深影响了企业级应用领域，<a href=\"http://openwhisk.org/\">Apache OpenWhisk</a>就是企业级无服务器领域的选择之一，它使得企业级应用也可以采用无服务器风格的架构构建应用程序。</p>\n<p>在微服务端到端交付流程上，Netflix开源了自家的<a href=\"http://www.spinnaker.io/\">Spinnaker</a>，Netflix作为微服务实践的先锋，不断推出新的开源工具来弥补社区中微服务技术和最佳实践的缺失。而<a href=\"http://projects.spring.io/spring-cloud/\">Spring Cloud</a>则为开发者提供了一系列工具，以便他们在所熟悉的Spring技术栈下使用这些服务协调技术(coordination techniques)，如服务发现、负载均衡、熔断和健康检查。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/3-Keycloak-1.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/3-Keycloak-1-1024x612.jpg\" alt=\"\" width=\"700\" height=\"418\"></a></p>\n<p>而在微服务的安全上，最常见的需求之一 是通过身份验证和授权功能来保护服务或API。这部分功能往往是最重要且不断重复构造的。而<a href=\"http://www.keycloak.org/\">Keycloak</a>就是一个开源的身份和访问管理解决方案，用于确保应用程序或微服务的安全。且几乎不需要编写代码，开箱即用。它支持单点登录，社交网络登录和标准协议登录(如OpenID Connect，OAuth2和SAML等)。</p>\n<h3>趋势2：以Docker为核心的数据中心方案逐渐走向成熟</h3>\n<p>在过去的两年，Docker社区有了突飞猛进的发展，似乎每期技术雷达都会出现Docker相关的条目。而Docker往往和DevOps联系起来，被认为是推动DevOps发展的杀手级工具，以至于有些人会以团队是否采用Docker作为团队是否具备DevOps能力的标志。</p>\n<p>而这一社区的创新数量则日渐平缓。一方面，开源社区激烈的竞争淘汰了一部分技术。另一方面，以Docker为中心的完整数据中心解决方案在不断的整合开源社区的零散工具并形成最佳实践。为端到端的开发和运维提供更完整的交付体验，各大厂商也相继开始推广自己的企业级整体收费解决方案，这表明Docker的使用已经走向成熟。</p>\n<p>在本期的技术雷达里的条目中出现了<a href=\"https://mesosphere.com/product/\">Mesosphere DC/OS</a>，这是构建统一技术栈数据中心的一个征兆。在这方面<a href=\"https://docs.docker.com/enterprise/\">Docker EE</a>和<a href=\"http://rancher.com/\">Rancher</a>都是非常有力的竞争者。根据我的判断，在未来的Docker社区里，统一容器化数据中心的竞争者将会进一步减少。而之前的私有云方案则慢慢会被“以Docker为核心数据中心级全栈交付”取代。</p>\n<h3>趋势3：不完整的DevOps实践阻碍着DevOps的发展</h3>\n<p>很遗憾看到<a href=\"https://www.thoughtworks.com/radar/techniques/a-single-ci-instance-for-all-teams\">单一持续集成实例</a>和<a href=\"https://www.thoughtworks.com/radar/techniques/ci-theatre\">不完整的持续集成</a><a href=\"https://www.thoughtworks.com/radar/techniques/ci-theatre\">（CI Theatre）</a>这样的条目出现在技术雷达里。可以感到企业应用DevOps技术的紧迫性。这同时也暴露了DevOps领域里“缺乏门槛较低且成熟的技术实践”的问题。</p>\n<p>大部分企业在DevOps转型中仅仅关注到了工具的升级。却忽视了价值流、生产流程中各个活动中的最佳实践以及DevOps团队文化的构建，这会使团队陷入“已经完成DevOps转型的假象“，而停止了团队的自我改进。</p>\n<p>DevOps的实践包含组织改进和技术升级两个部分，技术往往是最容易的部分。而缺乏组织改进的技术提升往往很难给组织带来质的飞跃。具备DevOps文化的团队则会不断反思和学习，通过共担责任和相互合作不断完善组织的DevOps实践。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/4-introspection.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/4-introspection.png\" alt=\"\" width=\"859\" height=\"512\"></a></p>\n<h3>趋势4：领域特定的DevOps实践开始出现</h3>\n<p>DevOps的最早实践来自于互联网企业的Web应用，相应的思想被引入企业级应用并促进了一系列工具的发展。虽然并不是每一种应用软件交付形式都适合DevOps，但随着DevOps的工具不断成熟。其它领域的DevOps实践也开始尝试借鉴Web应用领域的自动化工具，并逐渐形成领域级的DevOps实践。</p>\n<p>在人工智能领域，<a href=\"https://www.tensorflow.org/\">TensorFlow</a>就是这样一个例子，它可以有多种DevOps友好的安装和部署方式 ，例如采用Docker进行部署。</p>\n<p>在区块链领域，超级账本(<a href=\"https://www.hyperledger.org/\">HYPERLEDGER</a>) 就是这样一个例子，它提供了一套工具和服务，结合DevOps相关技术和实践形成了一个完整的解决方案。</p>\n<p>随着DevOps相关概念和技术不断向各个产业领域的深入发展，可以看到DevOps技术和实践带来的巨大影响力。然而，每个技术领域都有自己所关注的特性，并不是以往的DevOps实践可以全覆盖到的，这恰恰成为了DevOps技术和实践发展的契机。我很期待领域特定的DevOps技术实践给DevOps带来的发展。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/5-HYPERLEDGER.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/5-HYPERLEDGER-1024x492.jpg\" alt=\"\" width=\"700\" height=\"336\"></a></p>\n<h3>趋势5：采用DevOps进行技术债务重组和技术资产管理</h3>\n<p>技术债务类似于金融债务，它也会产生利息，这里的利息其实就是指由于鲁莽的设计决策导致需要在未来的开发中付出更多的努力。</p>\n<p>投资银行业往往采用多种金融工具组合的方式来处理企业的不良债务。而清理技术债务的实践和工具却乏善可陈。</p>\n<p>技术债务不光阻碍了企业通过新技术带来便利，还使企业偿还技术债务所承担的成本越来越高，例如技术人才的流失，技术利息等综合性风险。</p>\n<p>虽然极少会出现企业因技术债务而走向衰败的案例，但新晋企业凭借新技术和商业模式颠覆传统行业并夺取市场份额的报道却不断发生。 这从另一方面说明技术债务综合提升了采用新技术的机会成本，使企业不断失去创新和领先的巨大潜力。</p>\n<p>DevOps技术栈的多元化为分散遗留系统技术债务风险提供了一套灵活而又低风险的工具和方法论。不断帮助企业从遗留系统的负担中解脱出来。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/6-Vagrant-1.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/6-Vagrant-1-1024x513.png\" alt=\"\" width=\"700\" height=\"351\"></a></p>\n<p>而微服务则是首先通过领域拆分技术债，并用相应工具重组技术债。分离优质技术资产和不良资产，通过分散风险来降低抛弃成本。 而将API当做产品(<a href=\"https://www.thoughtworks.com/radar/techniques/apis-as-a-product\">APIs as a product</a>)可以从一个全新的演进视角去看待技术债，通过可用性测试和用户体验研究帮企业剥离出技术债务中的优质资产和不良资产。</p>\n<p>另一方面，本期技术雷达中出现了<a href=\"https://www.thoughtworks.com/radar/techniques/legacy-in-a-box\">封装遗留系统</a>这样的实践，它往往配合着Vagrant，Packer和Docker这样的工具一起使用。一方面它将技术债务的风险进行了隔离，另一方面它防止了遗留系统上产生的技术债利息的增长。</p>\n<h3>趋势6：安全成为推动DevOps全面发展的重要力量</h3>\n<p>安全是DevOps永远绕不开的话题，也往往是新技术在传统行业（例如金融和电信）应用中的最大阻碍。一方面，组织结构的转型迫使企业要打破原先的部门墙，这意味着很多原先的控制流程不再适用。另一方面，由于大量的DevOps技术来源于开源社区，缺乏强大技术实力的企业在应用相关技术时不免会有所担忧。</p>\n<p>从代码中解耦秘密信息的管理则让我们避开了一些开发过程中可能会产生的安全隐患。采用<a href=\"https://github.com/AGWA/git-crypt\">git-crypt</a>这样的工具可以帮我们保证在开发的过程中源代码内部的信息安全。而采用<a href=\"https://www.vaultproject.io/\">HashiCorp Vault</a>则提供了脱离应用程序代码的秘密信息存储机制，使得应用在运行过程中的秘密得到了有效保护。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/7-HashiCorp-Vault-1.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/7-HashiCorp-Vault-1-1024x742.jpg\" alt=\"\" width=\"700\" height=\"507\"></a></p>\n<p>Linux Security Module则一直在技术雷达的“采用”区域，通过SELinux和AppArmor这样的LSM兼容帮助团队评估谁可以访问共享主机上的哪些资源(包括其中 的服务)。这种保守的访问管理方法将帮助团队在其SDLC流程中建立更好的安全性。以往这是Ops团队需要考虑的问题，而对DevOps的团队来说，这是每一个人的事情。</p>\n<p>“合规性即代码”（Compliance as Code）是继“基础设施即代码”，“流水线即代码”之后的又一种自动化尝试。<a href=\"https://github.com/chef/inspec\">InSpec</a>作为合规性即代码的提出者和实现者，通过自动化手段确保服务器在部署后的运维生命周期中依然保持安全与合规。它所带来的意义在于将规范制度代码化，得到了确定性的结果和解释。</p>\n<p>在不远的将来，不难想象人们所面对的法律和法规规定不再是一堆会导致歧义的语言文字条目，而是一组由自动化测试构成的测试环境。</p>\n<p>安全性和易用性往往被认为是鱼与熊掌不可兼得的两个方面。在DevOps之前，团队吞吐量和系统稳定性指标曾经也面临这样的境遇，然而DevOps使得二者可以兼得。同样我也有信心看到在未来DevOps的领域里，更多易用且安全的工具将会不断出现。在降低DevOps所带来的安全风险的同时，也提升团队开发过程的顺畅性和用户便利性。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/8-InSpec.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/8-InSpec-1024x611.jpg\" alt=\"\" width=\"700\" height=\"418\"></a></p>\n<h3>趋势7：Windows Server和.NET平台下的DevOps技术潜力巨大</h3>\n<p>长期以来，Windows和.NET平台下的DevOps一直都是一个被低估的领域。一方面，社区缺乏对 Windows Server平台的兴趣。另一方面，<a href=\"https://community.spiceworks.com/networking/articles/2462-server-virtualization-and-os-trends\">Windows Server却有接近90%的市场占用率</a>，在Web服务器领域则有<a href=\"https://w3techs.com/technologies/overview/operating_system/all\">33.5%的市场占有率</a>。</p>\n<p>有充足理由证明这是一个潜力巨大的市场。 我们看到了<a href=\"https://www.thoughtworks.com/radar/tools/cake-and-fake\">CAKE和FAKE</a>这样的条目，作为.NET平台下替代MSBuild的构建解决方案， 它增强了.NET平台自动化方面的能力。而<a href=\"https://github.com/HangfireIO/Hangfire\">HANGFIRE</a>则提供了更易用和灵活的自动化进程调度框架。我很期待未来有更多Windows Server和.NET平台领域的创新。不久前，Docker已经可以在Windows下运行。可以预见到，Windows Server和.NET平台将会是下一阶段DevOps技术实践中值得深入发掘的领域。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/9-.NET_.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/04/9-.NET_.png\" alt=\"\" width=\"888\" height=\"289\"></a></p>\n<h3>趋势8：非功能性自动化测试工具的逐渐完备</h3>\n<p>自动化测试水平往往是衡量DevOps技术能力高低的重要指标，尤其是针对生产环境应用程序的非功能性自动化测试工具。一直以来，技术雷达都在尝试从不同的角度宣扬自动化测试的重要性，从软件的开发阶段延展到了整个应用生命周期甚至整体IT资产的管理上。</p>\n<p>这期的技术雷达仍然关注了非功能性自动化测试，<a href=\"https://github.com/philpep/testinfra\">TestInfra</a>是ServerSpec的Python实现，它使得用Pytest测试基础设施成为可能。而<a href=\"https://github.com/metacloud/molecule\">MOLECULE</a>旨在帮助开发和测试Ansible的Role 。通过在虚拟机或容器上为正在运行的Ansible Role测试构建脚手架，无需再手工创建这些测试环境。正如技术雷达所说的：“虽然这是一个相当年轻的项目，但我们看到了其蕴含的巨大潜力。”</p>\n<h3>趋势9：Python成为DevOps工作中所不可或缺的语言</h3>\n<p>早在DevOps刚刚开始盛行的时候，Python就是一个被寄予厚望的语言，因为大部分DevOps工具和实践都需要用到Python。虽然也有人尝试用Ruby或者NodeJS构建DevOps工具，然而都没有Python所构建的工具流行。与此同时，仍然不断有人把其它语言下编写的工具转化为Python的版本，TestInfra就是这样一个例子。</p>\n<p>随着Python在大数据、人工智能、区块链、微服务以及Docker中的发展，可以预见Python在日后的领域仍然会发挥重要的作用。</p>\n<p>以上对DevOps趋势的解读仅为个人观点，如有不当之处还望指出。关于更多技术在技术雷达中的使用建议请参考<a href=\"https://www.thoughtworks.com/radar/a-z\">这里</a>，谢谢。</p>\n<div></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111064\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111064votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111064\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 56</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "comment_nums": 0, "praise_nums": "1", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/04/1-DevOps-1024x426.jpg"], "create_date": "2017-05-03", "url": "http://blog.jobbole.com/111064/", "front_image_path": "full/4efecb1423ec0b1164163e6fc29cc2d280e0c1c1.jpg", "tags": "IT技术,DevOps"},
{"fav_nums": 3, "title": "Ubuntu 放弃战斗，Linux 桌面的悲哀", "url_object_id": "81627beb79308b11c83cd6b72585be36", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/86dd6e34ce91\">ManateeLazyCat</a>   </div><div>\n<p>最近看到 Ubuntu 放弃 Unity 和 Mir 开发，转向 Gnome 作为默认桌面环境的新闻，作为一个Linux十几年的老兵和Linux桌面的开发者，内心颇感良多。</p>\n<p>Ubuntu 做为全世界Linux界的桌面先驱者和创新者，突然宣布放弃自己多年开发的Unity，相当于在桌面领域，直接放弃了战斗向微软投降，不仅仅是Linux桌面的悲哀，更是对于全球Linux黑客坚信Linux必胜信心的极大打击。</p>\n<h3>曾经的Ubuntu粉丝</h3>\n<p>我还记得2006~2007年，那时候我还在成都写手机游戏，当时年少轻狂的我，一直幻想自己要做最牛掰的开发者，就像科幻电影里面的黑客一样，无所不能。那时候虽然Windows玩的很溜，但是一直都在核心技术外徘徊，不知道如何达到个人目标。</p>\n<p>上学的时候玩过 RedHat 6.0, 也装过 KDE/Gnome 的桌面环境，但是系统中的各种问题，比如无法使用输入法、中文字体配置很差，甚至因为显卡驱动的原因都无法正常开机，所以Linux对于当年的我来说，就像神话一样，只有顶级黑客才能玩的转的系统。</p>\n<p>直到后面用了 Ubuntu 6.10 和 Ubuntu 7.04, 当时的Ubuntu可以说是非常惊艳，原来RedHat和Suse在桌面端的各种细节问题一扫而光，装上系统以后就可以直接用，而且还可以非常容易的安装应用软件来深入学习Linux。可以说是Ubuntu带领我真正的入门了Linux， 经过很多年的深入学习Linux, 到后来在Linux上开发Emacs和Haskell相关的项目，直至后面创业做 deepin 操作系统。</p>\n<p>从我个人来说，对Ubuntu系统以及背后的开发者都是怀着无比的敬畏和崇拜。</p>\n<h3>我看这么多年 Ubuntu 的发展</h3>\n<p>Ubuntu从当年最佳的Linux桌面操作系统到今天宣布放弃自己研发的Unity桌面，已经有13年历史了，在我看来主要有以下几个阶段：</p>\n<h4>最初的惊艳</h4>\n<p>Ubuntu最初的发展目标就是把原来Linux系统需要手动操作的基本配置，比如字体、输入法和显卡驱动等问题内置到操作系统中，用户不用安装系统后还需要跟乱码、中文输入以及显示等问题斗智斗勇， 可以说那个时代的Ubuntu是解决了当时Linux普及的几个重要问题，把Linux系统从当时只有开发者才能玩转的高手系统普及到普通的电脑爱好者就可以折腾使用。</p>\n<h4>酷炫的Compiz管理器</h4>\n<p>我相信很多Linux爱好者都惊叹于当年 Compiz 这个3D窗口管理器能够达到的酷炫效果，比如3D旋转桌面、拖动窗口的果冻效果、一把火烧掉窗口的效果… 特别是同时代的Windows系统都还是非常原始的2D效果，甚至XP的窗口连窗口阴影都还没有的时候。当时的Linux系统的，特别是Compiz吸引大部分用户去尝试Linux系统，即使最后大家仅仅只是因为好奇或是玩玩，也大大增强了Linux系统的曝光率。</p>\n<p>从另外一方面，Linux从当年Compiz发展十年以后，反而是那些简单特效甚至没有特效的Linux系统得到最高的用户量，原因我觉得主要有两个：</p>\n<ul>\n<li>PC这种生产力的工具最重要的是高效，非常酷炫的特效长时间用，反而会极大干扰用户视觉，进而影响用户对内容的专注力，而且时间长了也很容易引起用户的视觉疲劳，反而是Mac那种恰到好处的轻微动画让用户感到优雅和舒服, 这方面Linux发行版 Elementary OS 做的要好很多</li>\n<li>任何操作系统需要长久留住用户，还是需要靠优秀的人机交互设计和丰富的应用来留住用户，操作系统只有给用户带来真实的价值，让用户工作更高效和生活更快乐，用户才会长期坚持下去，光靠酷炫的动画吸引，用户一旦视觉疲劳以后，最终还是会放弃Linux， 因为一个操作系统不能解决用户日常遇到的各种问题，在用户心中最多就是一个好玩的玩具而已</li>\n</ul>\n<h4>Gnome3 vs Unity</h4>\n<p>在 2011 年底， Gnome 发布了它最新的 Gnome3 系统， 当时 Gnome3 以酷炫的特效加上 JavaScript 的插件体系而吸引了开源社区开发者的兴趣，特别是 Gnome3 内置 GJS 引擎，可以直接在桌面环境中编写 JavaScript 插件后直接 reload 即可更新桌面环境的功能和视觉效果，还有吊炸天的 inspector 特性，可以直接通过鼠标点击界面后定位到对应的代码位置，再加上 GJS 可以从屏幕顶部打开一个类似 quake terminal 的下拉调试环境，在调试环境中直接像脚本语言那样实时列出任何对象的属性和方法，立即改立即生效。</p>\n<p>上面这些开发者特性，在那时候 Google 满天吹嘘 Html5/JavaScript 的美好未来的大环境下，对于开发者有极大的诱惑力，很多开发者都奔着 Gnome3 这些类似 Web 的开发方式而去，并贡献了大量好玩的插件。</p>\n<p>在 Gnome3 之前， Ubuntu 一直都在用 Gnome2 桌面环境，其实 Gnome3 在 2011 年发布之前已经规划了2年，从当时的宣传来说是下一代桌面环境，2009, 2010年Gnome3还在社区发布了大量吊炸天的预览视频。作为当时桌面系统先锋的 Ubuntu 也非常期待能用上 Gnome3。 而无奈 Gnome3 一次又一次跳票，最后Ubuntu实在等不及了，就在 Gnome2 桌面环境后台服务的基础之上，开发了自己的 Unity UI。</p>\n<p>当时社区也因为 Unity 和 Gnome3 的很多设计理念类似谴责Ubuntu在进行分裂行为。</p>\n<p>Unity 产品的特点主要定位在几点：</p>\n<ul>\n<li>HUD 的左上角搜索设计，快速搜索应用和很多插件提供的搜索结果，这一点和 Gnome3 的Launcher插件体系非常像，通过插件，可以搜索除应用外的更多搜索结果（比如天气、在线视频、计算器结果等）</li>\n<li>任务栏固定在左边，对宽屏更加优化，相对于程序员有更多的纵向空间</li>\n<li>全局菜单，通过合并顶部栏和窗口标题栏，进一步节省纵向空间</li>\n</ul>\n<p>我个人并不喜欢这些面向开发人员（而不是面向普通用户）的设计，但是撇开个人的主观设计喜好外，我认为Unity 是相对于 Gnome3 更成熟的产品，Unity 的很多改动都是针对 PC 桌面系统的真实痛点来改进的，特别是一些程序员的用户很喜欢 Unity 诸多设计。而不是像 Gnome3 那样一味的追求平板用户体验，极大降低了PC桌面用户的习惯和易用性， Gnome3的槽点我后面详细说。</p>\n<p>不论从商业公司的独立性发展考虑还是产品质量负责的角度，我都是非常支持 Ubuntu 当时独立开发自己Unity 桌面环境的行为，Unity 确实在随后的几年证明了自己的产品质量和设计细节都比 Gnome3 要好很多。</p>\n<h4>Wayland vs Mir</h4>\n<p>在 Gnome3 和 Unity 发展的同时，Intel的雇员 Kristian Høgsberg 正在领导开发新的显示服务器。Wayland相对于古老的X11来说最大的提升是，Gtk/Qt 这些图形库进行图形绘制时，不用像X11那样发送绘制消息到XServer来进行绘制，而是由Client自己进行图形绘制，Wayland只用担任图层混合器的作用。这样不但减少了X Client和X Server之间不必要的通讯，而且因为由Client自己进行渲染，所以很多画面撕裂和闪屏的现象从原理上就避免了。</p>\n<p>大家可以看一下下面的两张架构图来理解两者的差别：</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1ff4scv98jgj20et0e3t9g.jpg\"></p>\n<p style=\"text-align: center;\">X-architecture</p>\n</div>\n<p style=\"text-align: center;\"><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/large/63918611gy1ff4sd0lghqj208v0dwt98.jpg\" width=\"319\" height=\"500\"></p>\n<p style=\"text-align: center;\">Wayland-architecture</p>\n<p>Wayland 因为要彻底从技术架构上颠覆Linux几十年X11的渲染方式，不论从架构设计还是代码实现上都会非常复杂，不但要开发协议本身，还需要开发适合Wayland的混合器和窗口管理器，最后导致Wayland 1.0稳定版一再跳票。</p>\n<p>而Ubuntu在独立开发Unity桌面环境的同时，也仿造了Wayland的架构开发了自己的Mir显示服务器，除了等不及Wayland稳定之外，更重要的是Ubuntu要为了它的下一步宏伟计划　”Ubuntu Touch” ，按照Mark的设想，Mir不仅仅要像Wayland那样从原理上提升Linux图形渲染效率，而且Mir还得担负起手机和电脑融合的使命，可以让Ubuntu Touch的手机在插上显示器底座时，手机的应用通过Mir的支持，可以直接在外接显示器上显示手机应用窗口，最终达到“当你手机放到底座时就是电脑，拿走就是手机”的设想。</p>\n<p>不论Wayland还是Mir，虽然底层架构都非常先进，但是为了兼容现有的X11程序，它们分别开发了 XWayland 和 XMir 用于在新的显示服务器协议上支持现有的大多数 X11 程序（主要是Gtk2/Qt3/Qt4开发的大多数应用）。</p>\n<p>具有讽刺意味的是，Wayland和Mir本来就是要解决 X11 那种不适合现代PC场景繁琐的通讯协议，甚至很多开发者为了技术的洁癖都在大力安利 Wayland/Mir ，但是最后 XWayland 和 XMir 本身的兼容实现却比 X11 的实现更加“恶心”和繁琐，包括Mir的开发者最后都放弃 XMir 的开发。</p>\n<p>正是因为Wayland/Mir这样的技术无法彻底解决和大部分原本就基于X11协议而开发的应用的兼容性问题，最后导致基于Wayland/Mir开发的桌面系统从　”解决渲染性能问题“ 转变到　“无法运行很多现有Linux应用”　这一个更加让用户难以接受的结果。这也是后面基于Mir开发的新版Unity难产的重要原因。</p>\n<h4>Ubuntu Touch</h4>\n<blockquote><p>就像每一个程序员都有一个黑客梦一样，每一个Linux开发者都希望能用上纯粹的Linux手机操作系统，特别是Linux技术圈领域，大家更希望有一个面向开发者可玩性更强的Linux手机操作系统。</p></blockquote>\n<p>Mark从2011年宣布开发Ubuntu Touch到2015年第一只搭载Ubuntu的智能手机在欧洲上市，Ubuntu把大多数主力开发都投入到Ubuntu Touch手机操作系统的开发中，整整4年，世界上最好的Linux桌面开发团队把4年的时间浪费在开发一个在PC、手机、平板和电视上拥有强迫症般统一界面的Unity上，而且希望Ubuntu Touch能够占领低端的智能手机操作系统市场，或者像Mark说的那样在Android外给世界另外一个选择。</p>\n<p>这4年的时间，因为主力开发Ubuntu Touch的原因，Ubuntu桌面操作系统从原来的高速创新到鲜有改动，往往版本的发布就是软件仓库更新加上壁纸更新就发布新版了，不再像原来一样，每个版本都来易用性的提升和功能增强。</p>\n<p>而且大家都知道，2011年~2015年这几年正是安卓系统从起步到发展成全球移动操作系统霸主的４年，Ubuntu闭门造车了４年到2015年发布第一台Ubuntu Touch手机以来，Ubuntu Touch手机在全球销售惨淡，甚至无人问津。</p>\n<p>Ubuntu今天放弃自己开发的Unity重要原因，就是因为Ubuntu耗费了公司所有资源在开发一个用户根本就不会买的手机操作系统，Ubuntu Touch可以说是Ubuntu最愚蠢的决策：</p>\n<ul>\n<li>今天的手机和手机操作系统的发展就像当年 Wintel 的PC时代一样，芯片和硬件越来越快，硬件的快速迭代更新速度都快于软件层面的优化速度，就算最低端的手机性能甚至都比十几年前电脑更快，而手机作为现代消费品来说，用户更关心的是手机是不是新款的，能否打游戏，美颜拍照功能是否更好？智能手机时代，大家不再对低端智能手机感兴趣，所以“低端智能手机操作系统”本身就是一个伪命题</li>\n<li>智能手机作为最方便的通讯和娱乐工具，能否打游戏和基本应用是大家用一款手机最最最基本的要求了，可Ubuntu Touch不能玩游戏、不能上QQ和微信，只能打开终端和一些网页应用，不要说普通用户，我想就连那些天天嚷嚷　”我们需要一款Linux手机操作系统“　的开发者都不会用它</li>\n<li>强迫症般的统一设计：在5寸大屏的手机，整个任务栏切换全部在左侧，大家可以试一下，你在正常拿手机的情况下，能否方便的用大拇指去够最左侧的Launcher, 甚至还要在手机左侧的顶部和底部上下移动？把手指移动到手机顶部左右移动查看状态栏（你的手指够的到顶部吗？然后再做左右运动？）也做为一个创新设计宣传，这些反人类的设计是我作为一个产品经理非常无法忍受的，我经常吐槽Ubuntu Touch: Ubuntu Touch的交互设计师平常要不就是把手机放到桌子上设计的（而不是单手体验一下），要不就是Ubuntu Touch手机是屏幕厂商开的，Ubuntu Touch的很多交互设计都非常容易让手机从手里面滑落</li>\n</ul>\n<p>Ubuntu Touch不论从公司战略、产品时机、应用生态还是交互设计各方面来看都是非常愚蠢和非常失败的产品，而这一切都要怪罪于Mark本人开发者的产品思维和一意孤行，白白浪费了世界顶尖开发者的精力和理想。</p>\n<h4>FlatPak vs Snap</h4>\n<p>Linux桌面发展到今天依然无法和微软以及苹果系统本身竞争的一个重要原因就是，Linux系统软件包之间的依赖问题，系统和应用之间的紧耦合，应用和应用之间的依赖库紧耦合，只要底层库升级了，系统升级有可能会把应用升级挂，一个应用升级很有可能会导致另外一个应用无法使用。</p>\n<p>如果把系统所有的软件包和应用的依赖打印出来，你会发现整个桌面Linux操作系统就像一张巨大的错综复杂的蜘蛛网，蜘蛛网的任何一环坏掉都会引起系统和应用不稳定甚至无法使用的问题，同时应用厂商为了开源社区的诸多底层库升级疲于奔命, 最后的结果是，Linux操作系统在底层5万个软件包，2000多个应用，700个精品应用的时候，就已经非常非常的不稳定了，如果有一天Linux平台有上十万个应用的时候，系统和应用一定是崩溃的，因为任何底层的技术革新都会带来应用厂商的应用会失效或者因为API不兼容最后无法运行。</p>\n<p>所以，为了迎接将来Linux操作系统应用生态爆发的那一天，Linux操作系统必须像微软和苹果那样，在系统和应用之间构建一条抽象API层，有点类似微软的 Win32 API和.Net 的意思，只要应用遵守中间层的运行时API和接口以及应用之间做到互相隔离开，应用升级就不会影响到其他应用，系统底层做再多规模的底层库革新，只要革新完以后保证中间层调用接口不要变，系统的升级就完全不会影响到应用的稳定。</p>\n<p>举一个最简单的例子，微软从Windows XP开始，操作系统底层技术一直在变，但是你会发现十几年前应用厂商为Windows XP开发的应用依然可以在Windows 10最新的操作系统上运行，这种类型的兼容性才是桌面应用生态赖以生存的重要技术保障。</p>\n<p>而Gnome开发的FlatPak和Ubuntu开发的Snap就是为了解决应用之间的隔离而生的技术，这两个技术都通过Linux内核的cgroups技术，FlatPak是通过OsTree来解决应用多版本的问题。通过把应用之间隔离在沙盒之内，保证不同应用之间或者应用不同版本之间完全在文件系统上进行隔离，这样就彻底解决应用之间升级互相影响的问题，而且这两种技术通过引入应用程序运行时的runtime接口，保证了系统和应用之间有一个稳定的接口，从侧面也保证了系统和应用之间的依赖分离。</p>\n<p>FlatPak和Snap都能解决Linux系统依赖的问题，FlatPak的目标是解决Linux桌面现有应用的问题，Snap则是为了解决Ubuntu Touch而生的。</p>\n<p>听说Mark希望Snap不但能够运行在Linux上，还能运行到别的操作系统上。在我看来这也是一个错误的选择，微软和苹果找就有相关的成熟技术，根本不需要snap, 反而是Linux才需要这样的技术，希望 Ubuntu 能够把 snap 的技术发展壮大，有利于Linux操作系统的应用生态。</p>\n<h3>Gnome是一个比Unity更差的选择</h3>\n<p>从Ubuntu放弃Unity的那一刻起，Ubuntu已经放弃桌面了。很多不了解桌面环境开发的用户会觉得Ubuntu不是回归Gnome了吗？应该是开源社区的好事啊？</p>\n<p>桌面操作系统的用户体验和交互细节息息相关的就是桌面环境，而Gnome3桌面环境从各方面来说都不是面向普通用户的高质量产品。</p>\n<h4>核心开发者更关心技术折腾, 不再关心产品质量和API兼容性</h4>\n<p>Gnome好的地方是开发了封装了大量基于GObject的库，外部开发者能够快速基于这些GObject库来开发程序。</p>\n<p>但是从开发者的技术选型来说，比如最开始做vala, gnome shell的时候做 GJS/JavaScript, 到最近讨论用rust, 这些都可以看出Gnome3的开发者更关注的是实现桌面环境后台的编程语言和技术是否是最酷最新的，追求这个世界上最先进的技术是每个开发者的源动力，但是Linux桌面这十几年之所以发展停止不前的重要原因是：用户喜欢一个开箱即用、美观和稳定的桌面系统，用户不关心实现这些的后台技术是否是最屌的。对于真正理想的研发团队，或者真正的顶尖开发者来说，编程语言和最新的开发库只是工具和程序表达方式而已，只要编程能力高，什么程序都是可以开发的。</p>\n<p>而Linux社区的开发者，大多数开发者本身都是喜欢折腾最新技术的，因为最新的技术对于开发者来说可以学到很多新的知识，他们在新的编程语言和新的技术基础之上能够做出自己的东西，让自己更有价值和快乐，而这些都是非常自然的地方。但是我们应该考虑在先进技术的同时，面向真正的桌面用户做出稳定可靠的产品。</p>\n<p>Gnome3即使面向开发者都是极度不友好的，整个桌面环境就完全在一个JavaScript的环境中，中间没有任何整体的API设计和插件接口，Gnome3的插件作者都是通过 Gnome Shell 调试器追踪到一个JavaScript的Object对象，通过属性链的方式魔改很多对象的属性方式，最后来开发出 Gnome3 的插件。不通过插件API接口，而是通过对象的属性来编写的插件，导致只要 Gnome3 的核心代码一改变，或者属性链中的任一一个变量发生了变化，Gnome3插件就失效了，目前Gnome3在线插件的页面也只有20%的插件能够在最新版的Gnome3环境中安装运行。</p>\n<h4>Gtk+已经无力和Qt抗衡</h4>\n<p>我个人作为Gtk+骨灰粉，也是Gtk2hs的核心开发者，对Gtk+ 2000多个API以及很多GObject库（比如vte,webkit,poppler等）都非常熟悉。但是自从Gnome3弄伤心以后（我曾经写了12个Gnome3插件，１万多行代码都因为Gnome3各种乱改API后升级失效），我对Gtk+的信心也随之大大降低。</p>\n<p>特别是Gtk+3这个被Gtk+/Gnome开发者盛赞的版本，除了添加了一下 Overlay 的控件和CSS属性功能外，再没有大的功能改进。反观Qt, 从Qt4时代的各有千秋到Qt5的大幅度提升质量和功能，包括最新的QML大大提升了图形应用程序的开发（虽然QML对显卡兼容性还是有点问题）。</p>\n<p>Gtk+的很多API至今多有很多隐藏的小技巧，需要多年的踏坑经验才能完全掌握，而Qt本身的API设计要优秀的多。</p>\n<h4>Gnome3 不是一个产品质量的桌面环境</h4>\n<p>Gnome3 并不是一个产品质量的桌面环境：</p>\n<ul>\n<li>JavaScript本身不适合作为桌面环境这种常驻程序的开发语言，不论在执行速度，特别是在内存的控制上非常容易导致长时间运行不关机，内存越用越多的情况</li>\n<li>Gnome3除了窗口管理器mutter是单独一个进程外，所有的桌面模块（任务栏、顶部条、启动器、工作区）都是在同一个进程中运行，这样就导致只要有任何插件发生错误，整个桌面环境的所有模块都会连带崩溃而无法使用</li>\n<li>Gnome3的整个设计理念都是面向平板的，比如托盘区域默认隐藏，任务栏要戳一下热点才能显示，启动器图标过于巨大等，这些设计都会严重的影响PC日常使用的习惯和易用性</li>\n</ul>\n<p>所以Gnome3与其说是不如Unity桌面环境（我相信Ubuntu的Mark也知道），还不如说Ubuntu彻底放弃在桌面上的创新和主力研发，彻底向微软投降了。</p>\n<h3>开源社区 vs 商业产品</h3>\n<p>从最初的RedHat放弃桌面系统，Suse和微软深入合作，2016年Ubuntu移植Bash到Win10, 到如今Ubuntu放弃Unity和Mir后，这么多年，大家在开源事业上努力奋斗，但是从最开始的斗志昂然到如今的放弃，为什么开源的桌面系统做不好呢？</p>\n<p>我个人也在带领团队开发deepin操作系统，这么多年开发Linux桌面操作系统的经历，我个人对于开源社区和商业产品的理解有几点：</p>\n<h4>Geek是这个世界的革命先锋，但不能以Geek理念做产品</h4>\n<p>电脑极客在以飞快的速度在改变世界，正是有这些非常聪明的极客和开源黑客，全世界的科技发展，特别是开源技术的在最近十年获得了极大的发展。</p>\n<p>电脑极客在所有人的类型是非常稀少的，这些全世界1%的人用各自的聪明才智推动开源运动的发展，包括Ubuntu的CEO Mark本人也是极客中的极客，曾经的Debian开发者，在推动Ubuntu初期解决了很多Linux桌面易用性的问题。</p>\n<p>电脑极客与其说是一种职业，还不如说是一种生活方式，电脑极客希望全世界都像电脑运行那样：刚正不阿、完美、统一的美，没有一丝一毫的例外情况，所有的结果都应该在预计和期望范围。</p>\n<p>但是不能用极客的思维去做产品，因为这个世界本质就是混沌的、有各种各样缺陷、更强调社会习惯和协作，而普通用户组成的非电脑社会，更多人只在乎这个社会都在怎么使用电脑？大家在流行使用什么？他们更在于电影明星在用什么，模仿各种潮流，而不在于一个程序员内心在想什么。</p>\n<p>Ubuntu最开始推崇Unity，是从产品质量和公司的掌控力出发的，开源社区指责的分裂我觉得是不客观的。但是后面为了统一PC、手机、平板、电视的整个操作界面，所有界面都基于左侧任务栏＋顶部任务栏＋搜索导向的Unity启动器来设计的，从极客爱好者来看，这是一种从程序代码到总体实现的一种统一，一种认为世界会赞赏的方式来构建Ubuntu系统。</p>\n<p>反观我们自己作为一个普通人，我们会怎么对待这几样设备？</p>\n<ul>\n<li>PC: 作为生产力工具，比如要写一个文档，写段代码，做一个复杂的表格和图像时，PC绝对是生产力的代表，但是因为PC大多数都需要一个人在固定的地方长时间的工作，所以现在PC不是沦落了，而是专注于工作环境的计算平台，所以PC感觉给人很严肃很累，而人做为一个天性懒惰的动物，大多数人是尽量干完工作就离开PC的，但是无论如何，PC作为整个社会的生产力工具，确实必不可少</li>\n<li>手机：手机作为大家最顺手的工具、玩游戏、聊天、浏览页面等，可以说是现代人的第三只手，大部分时间都离不开手机这种移动计算设备</li>\n<li>平板：一种非常轻量的电脑，不需要过多的知识，不需要看着密密麻麻的的键盘，只用直觉化的操作即可</li>\n<li>电视：我能想到的最佳状态就是，躺在沙发上，拿着遥控板，看电影，上下左右确定，这就是最常用的操作</li>\n</ul>\n<p>我们认真的总结，即可发现这几个设备的常用交互方式：</p>\n<ul>\n<li>PC：　 鼠标＋键盘</li>\n<li>手机： 大拇指</li>\n<li>平板： 食指</li>\n<li>电视： 遥控板</li>\n</ul>\n<p>所以电脑极客经常问的一句话 “为什么不做手机操作系统？”，更多的时候是在问 “为什么不能像PC那样把别的计算平台做的更加赋予生产力？”，所以当初Ubuntu Touch追求的　“同一套Unity界面，让不同的计算平台用统一套界面和交互设计来满足”，这本身就是一个伪命题，或者说是电脑极客自己的一厢情愿。</p>\n<p>这几个计算平台不论从使用场景、用户交互习惯还是用户对这些计算设备的期望都完全不同，当初微软融合电脑和平板本身，都已经让喜欢PC的用户大大不爽，最后迫使微软停止融合的设计，改回最初的PC操作设计。而Ubuntu所有计算平台的操作融合更是错的非常离谱，当第一代Ubuntu Touch手机推出市场后，先不论应用的稀缺，光是操作系统就和主流的　“看到图标就点，返回就按Home键”　的主流手机操作系统截然不同，最后惨淡收场。</p>\n<p>所以，极客本身是世界革命的科技先锋，但是不能用极客思维去做产品，因为极客毕竟还是这个世界上的非常少数的人，极客思维本身无法代表更为广泛的普通用户。</p>\n<h4>底层技术的革新需要采用温水煮青蛙的方式，而不是激进的踏进沙漠去构建大海</h4>\n<p>很多人经常问我　“deepin什么时候用wayland?” ，我首先想回答的是　“合适的时候就会用”，但是我更想回答的是　”deepin只会推动稳定的技术和产品给用户，而不是拿用户当小白鼠”。</p>\n<p>Wayland和Mir本身都是非常革新的显示技术，我相信也是Linux未来显示技术的主流，但是作为现阶段来说，Wayland依然不是一个稳定的产品级方案：<br>\n１、显卡厂商原来都是基于X11的libGL进行驱动编写的，虽然现在很多显卡厂商也在往Wayland迁移，但是整体的显卡驱动兼容性还不如X11, 直接的问题就是，一旦用了Wayland后，桌面系统会相对于X11更容易遇到花屏和无法登入图形界面的情况<br>\n２、Wayland本身就是对于X11协议是一种颠覆，大量的现有Linux程序依然是Gtk+2/Qt4开发的，这些应用程序依然无法在Wayland运行，而新的Gtk+3/Qt5虽然都已经对Wayland进行了支持，但是这类应用还非常少，导致移植到Wayland会有大量的应用程序无法使用，虽然有XWayland项目，但应用兼容性和重写的问题短期之内还不会有很大的改善<br>\n３、在X86这种CPU性能过剩的平台，Wayland的性能提升并不明显，最起码普通用户无法察觉这种性能提升，我认为Wayland现阶段更适合那种能够完全控制显卡和应用本身，并且对渲染性能特别敏感的计算平台，不适合PC这种开放式的高性能计算平台</p>\n<p>在显卡厂商逐渐支持Wayland改善显卡驱动的情况下，在Linux桌面，我觉得应该大力把桌面环境已经应用迁移到Gtk+3/Qt5的图形库上，等有一天显卡厂商驱动兼容性足够好以后，通过修改窗口管理器和移植应用的方式，直接把上层的桌面环境和应用软件整体迁移到Wayland上。</p>\n<p>当迁移完成后，用户在显卡驱动以及应用方面完全感受不到差异的时候，才能说是负责任和持续的迁移方案。而不是很多开源社区的用户说的先迁移到Wayland上去再说，这样会导致使用Wayland的时候，让用户同时面临显卡驱动和更加匮乏的应用生态问题。</p>\n<p>如果打个比方，整个开源社区是整个世界，革新技术是革命领袖的话。任何一个Linux桌面系统从X11迁移到Wayland更应该考虑策略和渐进的替换方式，而不是一脚踏进沙漠以后要构建整个海洋。任何一项革新的技术除了技术先进性一定要考虑革命时期的群众基础，只有在革新的时候解决用户的问题，得到用户支持，这样的技术革新才能完成底层核心技术的切换，否则就和当年Intel/HP大力推崇的安腾CPU,虽然各种技术先进，但是因为不兼容现有操作系统和应用，最后不得已而抛弃。</p>\n<h4>安卓生态时代，不要做Linux手机操作系统，这不仅仅只是一个技术问题</h4>\n<blockquote><p>Linux桌面面对的是微软的生态帝国，如果拼尽全力，可能还有1%的成功可能性。而Linux手机操作系统面对安卓的时候，会死的一点都不剩的。</p></blockquote>\n<p>为什么会这么说？因为微软花了几十年构建的生态帝国，是靠当时微软在PC行业的势，当时的时势加上微软自身的努力（只有做过操作系统生态的团队才能理解微软当年有多苦逼）做到今天的地步的。做操作系统系统这种承上启下＋白菜钱白粉心的企业一般都是前期是孙子后期是爷的命，前期遇到硬件应用和各种各样奇怪的问题，操作系统厂商各种背锅（为啥别的操作系统没有这个问题？）干各种不是操作系统应该干的活，以一己之力推动整个生态的发展。而现在PC的所有生态和需求都已经定型了，微软不会鸟你，也没有各种不懂的媒体跟风干扰你（他们最多就说PC是夕阳产业，哈哈），你和你的团队只需要一点一点的努力，用十倍于微软苦逼的努力，只要在某些行业和开源社区做出成绩，就会有用户认同你，PC再夕阳大家也不可能离开它，因为生产力是整个社会最基本的动力，大家都用手机和平板办公，整个社会的生产力就会成倍的降低，所以大家离不开PC，我经常会讽刺那些说PC没用，平板才是未来的朋友：　“你用平板写代码或者你们公司的财务用平板给你算工资，我就愿意相信你”　。</p>\n<p>移动终端本身就是面向普通老百姓的新一代计算设备，在这个行业，所有的人，所有的企业都在围绕安卓构建新的应用，面临一个日新月异更新换代的行业，对于操作系统厂商来说，这些不是机会，而是你无法挑战安卓系统的巨大阻碍，而且每天都会更大，因为有更多的开发者和开发厂商自己掏钱投入安卓阵营。人类社会是一个以跟风和模仿为基调的动物群体，当你做的和大多数人都不一样，各种人就会干扰你，导致你无法专心做好操作系统，而且面对一个不断发展的生态，整个行业的切换成本是你现在无法撼动安卓的重要原因，因为安卓构建的不光光是操作系统本身，构建更多的是日益越大的行业投入和切换成本。</p>\n<p>反观PC行业，在真正有下一代生产力计算平台出现之前（安卓只是娱乐平台），PC依然是整个社会生产力的核心，大家不可能离开PC，PC也不会像很多没有思考能力的人期望的那样消失殆尽。任何PC操作系统厂商只要一步一步的花费数十年的时间，终有一天会构建庞大的桌面应用生态，在生产力上和开放源代码上给这个社会带来更多的价值，其实Mac系统本身就是一个很好的例子。</p>\n<p>PC操作系统不是未来，但是PC操作系统是现代还不可或缺的计算平台，而且PC操作系统是全世界对软件工程要求最高的挑战。当一个团队具备实力能够完整构建像微软那样的PC操作系统能力和知识积累后，这个团队的实力能够在下一代计算平台掌握绝对的控制力。</p>\n<p>大家熟知的励志故事就是：苹果在PC被微软打爆以后，用iPhone让微软再也爬不起来。</p>\n<h4>包格式只对系统核心有用，对于应用厂商毫无意义</h4>\n<p>我一直认为包格式是服务器操作系统和桌面操作系统系统核心才需要的东西，因为具有依赖关系的包特别适合构建相互关联的操作系统底层核心库，只要你升级一下核心库，整个操作系统的核心技术就升级了，不用担心冗余和更新问题。</p>\n<p>但是包格式对于应用厂商无意义，操作系统站在应用厂商的出发点最应该考虑的是提供一套接口抽象层和应用隔离机制，抽象接口层的目的是分离系统和应用，应用隔离机制的目的是隔离应用之间在文件系统上的依赖。</p>\n<p>只有这样，才能真正构建一个Linux桌面的生态：</p>\n<ul>\n<li>抽象层做好以后，操作系统可以在保持接口不变的同时，随意革新操作系统核心技术，而不用担心操作系统升级以后，应用程序无法运行的问题</li>\n<li>应用隔离机制做好以后，应用厂商的不同版本和不同应用厂商的应用之间不会互相影响</li>\n<li>开发者不用再写完软件还要考虑构建不同发行版的打包格式，这也是阻碍软件无法在所有Linux发行版运行的重要原因</li>\n</ul>\n<p>这样做的目的是让彻底解放操作系统厂商，操作系统厂商的开发人员可以把所有精力放在核心技术的开发和应用开发接口的维护上，而不用每天除了开发操作系统还需要打包各种应用软件包。</p>\n<p>应用的质量和功能应该由应用厂商自己维护，而不是丢锅给操作系统开发人员，应用的好坏本质山应该通过用户评价和经济刺激让应用厂商自己维护，如果应用长期没有作者维护，用户自然会抛弃应用的，进行自然淘汰，就像Windows上的应用，哪个作者更努力做的鞥好，用户就会越多。</p>\n<p>而不是像现在Linux发行版的打包人员，固定的几十个人面对着成千上万的应用软件打包工作，不论从工作量还是持续发展来说，这种分担工作量的组织方式本来就是不合理的，如果每个应用都需要操作系统开发人员来维护，固定人数和固定时间面对无穷的应用时，势必会导致精力不够，甚至核心的系统开发者不再给开源社区做贡献时，他维护的应用的更新和质量就会下降，最后损害的还是用户。</p>\n<p>所以应用隔离的技术不仅仅只是技术上模仿微软和苹果，而是从社会的生产力上彻底解决工作分担组织的问题，只有把应用的维护工作丢给应用开发者这些直接利益关系者才能持续的推动整个生态的前进，而不仅仅通过开源精神和信仰把所有的维护负担都丢给Linux发行版的开发者。</p>\n<h3>Linux桌面的未来在哪里？</h3>\n<p>说了这么多，Linux桌面的未来在哪里？</p>\n<p>实话实说，我不知道，我要是知道的话，deepin早已经打败微软了，哈哈哈。</p>\n<p>但是从我这么多年开发桌面系统的精力，我总结了几条经验：</p>\n<ul>\n<li>PC不需要革命性创新，只需满足桌面用户长期的习惯+微创新, 大多数Linux发行版自嗨式的折腾后，用户告诉我们他们最需要的PC操作系统就是那些尽量满足他们PC操作习惯的系统，如果有一些局部的微创新能够形成自己的特色就很好了</li>\n<li>大力发展应用生态才是王道: Linux精品应用还在千这个量级，不论自己研发，还是和应用厂商合作开发，抑或通过商业来刺激应用厂商自己开发，才会有越来越多的用户和行业去使用Linux操作系统，Linux桌面要成功，这是最最重要的一个一点，而不仅仅是拿开源作者或学生业余写的软件当做产品去忽悠现代这些越来越挑剔的桌面用户</li>\n<li>Linux桌面需要更深入的去解决普通用户的问题: 需要针对Linux桌面用户的痛点进行更深入的解决，除了上面说的应用外，比如显卡驱动、打印机驱动以及行业应用都是非常必要和重要的</li>\n<li>更多的用户基数才能引爆Linux桌面生态: Ubuntu聚集了大多数Linux开发者，真正的Linux桌面成熟，需要面对更为广阔的普通用户需求，只有解决了10%以上用户的需求（苹果Mac系统也就这个占有率），Linux桌面才能自豪的说终于成功了</li>\n</ul>\n<h3>Linux桌面是世界上最大的软件工程挑战, 也是所有Linux爱好者的希望</h3>\n<p>Linux桌面以及桌面应用生态的构建是世界上最大的软件工程挑战，几十年各种伟大的开源公司和开源社区在为这个目标努力，我相信只要持续努力，最终可以从希望变成理想成真的。</p>\n<p>Ubuntu今天放弃战斗了，非常可惜一面Linux桌面的旗帜倒下了。</p>\n<p>做为依然奋斗在Linux桌面事业的开发者，想跟未来的开源开发者说一句话：</p>\n<blockquote><p>累了就休息一下，但千万不要放弃！</p></blockquote>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111038\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111038votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111038\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 8 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "comment_nums": 8, "praise_nums": "2", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/10/ubuntu-logo.jpg"], "create_date": "2017-04-30", "url": "http://blog.jobbole.com/111038/", "front_image_path": "full/dd50a34d1fcae2b4cf08ec64a6d2b88e6a152f05.jpg", "tags": "IT技术,Linux,Ubuntu"},
{"fav_nums": 3, "title": "Linux 下网络协议分析器 Wireshark 使用基础", "url_object_id": "bbc079fdcf9870763eb528189ac7c691", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://linuxconfig.org/basic-of-network-protocol-analyzer-wireshark-on-linux\">Nick Congleton</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8457-1.html\">wcnnbdk1</a>   </div><div> Wireshark 是 Kali 中预置的众多有价值工具中的一种。与其它工具一样，它可以被用于正面用途，同样也可以被用于不良目的。当然，本文将会介绍如何追踪你自己的网络流量来发现潜在的非正常活动。</div>\n<p>Wireshark 相当的强大，当你第一次见到它的时候可能会被它吓到，但是它的目的始终就只有一个，那就是追踪网络流量，并且它所实现的所有选项都只为了加强它追踪流量的能力。</p>\n<h3 id=\"toc_1\">安装</h3>\n<p>Kali 中预置了 Wireshark 。不过，<code>wireshark-gtk</code> 包提供了一个更好的界面使你在使用 Wireshark 的时候会有更友好的体验。因此，在使用 Wireshark 前的第一步是安装 <code>wireshark-gtk</code> 这个包。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-590afdff25c79708746464\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# apt install wireshark-gtk\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-590afdff25c79708746464-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-590afdff25c79708746464-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-590afdff25c79708746464-1\"><span class=\"crayon-p\"># apt install wireshark-gtk</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-590afdff25c79708746464-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>如果你的 Kali 是从 live 介质上运行的也不需要担心，依然有效。</p>\n<h3 id=\"toc_2\">基础配置</h3>\n<p>在你使用 Wireshark 之前，将它设置成你使用起来最舒适的状态可能是最好的。Wireshark 提供了许多不同的布局方案和选项来配置程序的行为。尽管数量很多，但是使用起来是相当直接明确的。</p>\n<p>从启动 Wireshark-gtk 开始。需要确定启动的是 GTK 版本的。在 Kali 中它们是被分别列出的。</p>\n<p><img class=\"aligncenter\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201704/28/023000gt7itb6djtth7eqq.jpg\" alt=\"Wireshark running on Kali\"></p>\n<h3 id=\"toc_3\">布局</h3>\n<p>默认情况下，Wireshark 的信息展示分为三块内容，每一块都叠在另一块上方。（LCTT 译注：这里的三部分指的是展示抓包信息的时候的那三块内容，本段配图没有展示，配图 4、5、6 的设置不是默认设置，与这里的描述不符）最上方的一块是所抓包的列表。中间的一块是包的详细信息。最下面那块中包含的是包的原始字节信息。通常来说，上面的两块中的信息比最下面的那块有用的多，但是对于资深用户来说这块内容仍然是重要信息。</p>\n<p>每一块都是可以缩放的，可并不是每一个人都必须使用这样叠起来的布局方式。你可以在 Wireshark 的“选项Preferences”菜单中进行更改。点击“编辑Edit”菜单，最下方就是的“选项Preferences”菜单。这个选项会打开一个有更多选项的新窗口。单击侧边菜单中“用户界面User Interface”下的“布局Layout”选项。</p>\n<p><img class=\"aligncenter\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201704/28/023002awqjo54zp4r125qr.jpg\" alt=\"Wireshark's layout configuration\"></p>\n<p>你将会看到一些不同的布局方案。上方的图示可以让你选择不同的面板位置布局方案，下面的单选框可以让你选择不同面板中的数据内容。</p>\n<p>下面那个标记为“列Columns”的标签可以让你选择展示所抓取包的哪些信息。选择那些你需要的数据信息，或者全部展示。</p>\n<h3 id=\"toc_4\">工具条</h3>\n<p>对于 Wireshark 的工具条能做的设置不是太多，但是如果你想设置的话，你依然在前文中提到的“布局”菜单中的窗口管理工具下方找到一些有用的设置选项。那些能让你配置工具条和工具条中条目的选项就在窗口选项下方。</p>\n<p>你还可以在“视图View”菜单下勾选来配置工具条的显示内容。</p>\n<h3 id=\"toc_5\">功能</h3>\n<p>主要的用来控制 Wireshark 抓包的控制选项基本都集中在“捕捉Capture”菜单下的“选项Options”选项中。</p>\n<p>在开启的窗口中最上方的“捕捉Capture”部分可以让你选择 Wireshark 要监控的某个具体的网络接口。这部分可能会由于你系统的配置不同而会有相当大的不同。要记得勾选正确的选择框才能获得正确的数据。虚拟机和伴随它们一起的网络接口也同样会在这个列表里显示。同样也会有多种不同的选项对应这多种不同的网络接口。</p>\n<p><img class=\"aligncenter\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201704/28/023003od9y9mmmo9dr9mym.jpg\" alt=\"Wireshark's capture configuration\"></p>\n<p>在网络接口列表的下方是两个选项。其中一个选项是全选所有的接口。另一个选项用来选择是否开启混杂模式。这个选项可以使你的计算机监控到所选网络上的所有的计算机。（LCTT 译注：混杂模式可以在 HUB 中或监听模式的交换机接口上捕获那些由于 MAC 地址非本机而会被自动丢弃的数据包）如果你想监控你所在的整个网络，这个选项是你所需要的。</p>\n<p><strong>注意:</strong> 在一个不属于你或者不拥有权限的网络上使用混杂模式来监控是非法的！</p>\n<p>在窗口下方的右侧是“显示选项Display Options”和“名称解析Name Resolution”选项块。对于“显示选项Display Options”来说，三个选项全选可能就是一个很好的选择了。当然你也可以取消选择，但是最好还是保留选择“实时更新抓包列表”。</p>\n<p>在“名称解析Name Resolution”中你也可以设置你的偏好。这里的选项会产生附加的请求因此选得越多就会有越多的请求产生使你的抓取的包列表显得杂乱。把 MAC 解析选项选上是个好主意，那样就可以知道所使用的网络硬件的品牌了。这可以帮助你来确定你是在与哪台设备上的哪个接口进行交互。</p>\n<h3 id=\"toc_6\">抓包</h3>\n<p>抓包是 Wireshark 的核心功能。监控和记录特定网络上的流量就是它最初产生的目的。使用它最基本的方式来作这个抓包的工作是相当简单方便的。当然，越多的配置和选项就越可以充分利用 Wireshark 的力量。这里的介绍的关注点依然还是它最基本的记录方式。</p>\n<p>按下那个看起来像蓝色鲨鱼鳍的新建实时抓包按钮就可以开始抓包了。（LCTT 译注：在我的 Debian 上它是绿色的）</p>\n<p><img class=\"aligncenter\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201704/28/023005u1zcaegq157hze4d.jpg\" alt=\"Wireshark listing packet information\"></p>\n<p>在抓包的过程中，Wireshark 会收集所有它能收集到的包的数据并且记录下来。如果没有更改过相关设置的话，在抓包的过程中你会看见不断的有新的包进入到“包列表”面板中。你可以实时的查看你认为有趣的包，或者就让 Wireshark 运行着，同时你可以做一些其它的事情。</p>\n<p>当你完成了，按下红色的正方形“停止”按钮就可以了。现在，你可以选择是否要保存这些所抓取的数据了。要保存的话，你可以使用“文件”菜单下的“保存”或者是“另存为”选项。</p>\n<h3 id=\"toc_7\">读取数据</h3>\n<p>Wireshark 的目标是向你提供你所需要的所有数据。这样做时，它会在它监控的网络上收集大量的与网络包相关的数据。它使用可折叠的标签来展示这些数据，使得这些数据看起来没有那么吓人。每一个标签都对应于网络包中一部分的请求数据。</p>\n<p>这些标签是按照从最底层到最高层一层层堆起来的。顶部标签总是包含数据包中包含的字节数据。最下方的标签可能会是多种多样的。在下图的例子中是一个 HTTP 请求，它会包含 HTTP 的信息。您遇到的大多数数据包将是 TCP 数据，它将展示在底层的标签中。</p>\n<p><img class=\"aligncenter\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201704/28/023007tjhoy3s4y4o1ytiu.jpg\" alt=\"Wireshark listing HTTP packet info\"></p>\n<p>每一个标签页都包含了抓取包中对应部分的相关数据。一个 HTTP 包可能会包含与请求类型相关的信息，如所使用的网络浏览器，服务器的 IP 地址，语言，编码方式等的数据。一个 TCP 包会包含服务器与客户端使用的端口信息和 TCP 三次握手过程中的标志位信息。</p>\n<p><img class=\"aligncenter\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201704/28/023009rl3hzhyk3a8ljjdk.jpg\" alt=\"Wireshark listing TCP packet info\"></p>\n<p>在上方的其它标签中包含了一些大多数用户都感兴趣的少量信息。其中一个标签中包含了数据包是否是通过 IPv4 或者 IPv6 传输的，以及客户端和服务器端的 IP 地址。另一个标签中包含了客户端和接入因特网的路由器或网关的设备的 MAC 地址信息。</p>\n<h3 id=\"toc_8\">结语</h3>\n<p style=\"text-align: center\">即使只使用这些基础选项与配置，你依然可以发现 Wireshark 会是一个多么强大的工具。监控你的网络流量可以帮助你识别、终止网络攻击或者提升连接速度。它也可以帮你找到问题应用。下一篇 Wireshark 指南我们将会一起探索 Wireshark 的包过滤选项。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111051\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111051votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111051\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "comment_nums": 0, "praise_nums": "1", "front_image_url": ["https://dn-linuxcn.qbox.me/data/attachment/album/201704/28/023000gt7itb6djtth7eqq.jpg"], "create_date": "2017-05-01", "url": "http://blog.jobbole.com/111051/", "front_image_path": "full/64ee1ddeba1354ba8ae7ca4f99ff0009ece8a349.jpg", "tags": "IT技术,Kali,Linux,WireShark"}
]